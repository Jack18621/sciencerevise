<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Science Revise - Science Study Platform</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/3.9.1/chart.min.js"></script>
<style>
        :root[data-theme="light"] {
            --primary-color: #4f46e5;
            --primary-dark: #4338ca;
            --secondary-color: #7c3aed;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #dc2626;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        :root[data-theme="dark"] {
            --primary-color: #6366f1;
            --primary-dark: #4f46e5;
            --secondary-color: #8b5cf6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --bg-primary: #1e293b;
            --bg-secondary: #0f172a;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .container {
            max-width: 100%;
            margin: 0;
            padding: 0;
            width: 100%;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            padding: 16px 24px;
            color: white;
            border-bottom: 1px solid var(--border-color);
            width: 100%;
            box-sizing: border-box;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin: 0;
        }
        
        .nav-tabs {
            display: flex;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            padding: 0 32px;
        }
        
        .nav-tab {
            padding: 16px 24px;
            border: none;
            background: none;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }
        
        .nav-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        
        .nav-tab:hover {
            color: var(--primary-color);
            transform: translateY(-1px);
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 32px;
            padding: 32px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }
        
        .study-area {
            background: var(--bg-primary);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            box-shadow: var(--shadow);
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 24px;
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .subject-selection {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            padding: 32px;
            background: var(--bg-primary);
            border-radius: 16px;
            border: 1px solid var(--border-color);
        }
        
        .subject-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .subject-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-4px);
            box-shadow: 0 8px 25px -8px rgba(79, 70, 229, 0.3);
        }
        
        .subject-card.selected {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border-color: var(--primary-color);
        }
        
        .subject-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 16px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--primary-color);
            transition: all 0.2s ease;
        }
        
        .subject-card.selected .subject-icon {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .subject-card h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .subject-card p {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .section-card {
            background: var(--bg-primary);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }
        
        .section-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }
        
        .section-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .section-content {
            padding: 24px;
        }
        
        .topic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .topic-item {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
        }
        
        .topic-item:hover {
            border-color: var(--primary-color);
            background: var(--bg-tertiary);
            transform: translateY(-2px);
        }
        
        .topic-item.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
        }
        
        .btn {
            padding: 10px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-1px);
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            border-color: var(--primary-dark);
        }
        
        .mode-selection {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }
        
        .mode-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .mode-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-4px);
            box-shadow: 0 8px 25px -8px rgba(79, 70, 229, 0.2);
        }
        
        .mode-icon {
            width: 40px;
            height: 40px;
            margin: 0 auto 12px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--primary-color);
        }
        
        .mode-card h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .mode-card p {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .question-container {
            background: var(--bg-primary);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            padding: 32px;
            margin-bottom: 24px;
        }
        
        .question-text {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 24px;
            line-height: 1.4;
        }
        
        .options-grid {
            display: grid;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .option {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 16px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
        }
        
        .option:hover {
            border-color: var(--primary-color);
            background: var(--bg-tertiary);
            transform: translateX(4px);
        }
        
        .option.selected {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }
        
        .option.correct {
            border-color: var(--success-color);
            background: var(--success-color);
            color: white;
        }
        
        .option.incorrect {
            border-color: var(--error-color);
            background: var(--error-color);
            color: white;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 24px;
        }
        
        .progress-info {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .feedback {
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease;
        }
        
        .feedback.correct {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }
        
        .feedback.incorrect {
            background: rgba(220, 38, 38, 0.1);
            color: var(--error-color);
            border: 1px solid var(--error-color);
        }
        
        .terms-container {
            background: var(--bg-primary);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            padding: 32px;
            text-align: center;
        }
        
        .term-text {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 24px;
        }
        
        .definition-input {
            width: 100%;
            min-height: 120px;
            padding: 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 16px;
            resize: vertical;
            margin-bottom: 20px;
            font-family: inherit;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }
        
        .definition-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .rating-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .rating-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .rating-btn.hard {
            background: var(--error-color);
            color: white;
        }
        
        .rating-btn.medium {
            background: var(--warning-color);
            color: white;
        }
        
        .rating-btn.easy {
            background: var(--success-color);
            color: white;
        }
        
        .rating-btn:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }
        
        .settings-container {
            background: var(--bg-primary);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            padding: 32px;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .setting-item:last-child {
            border-bottom: none;
        }
        
        .setting-label {
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .setting-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 4px;
        }
        
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .toggle-switch.active {
            background: var(--primary-color);
        }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .toggle-switch.active::after {
            transform: translateX(26px);
        }
        
        .progress-overview {
            background: var(--bg-primary);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            padding: 32px;
            margin-bottom: 24px;
        }
        
        .progress-charts {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .chart-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .chart-title {
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
        }
        
        .mastery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .mastery-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
        }
        
        .mastery-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .mastery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .mastery-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .mastery-percentage {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .progress-bar {
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.3s ease;
        }
        
        .mastery-stats {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .hidden {
            display: none !important;
        }
        
        .sidebar-section {
            background: var(--bg-primary);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .sidebar-section:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .sidebar-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .sidebar-header h3 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .sidebar-content {
            padding: 20px;
            text-align: center;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        /* Notification System */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .notification {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px 20px;
            min-width: 300px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInRight 0.3s ease;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .notification:hover {
            transform: translateX(-4px);
        }
        
        .notification.success {
            border-left: 4px solid var(--success-color);
        }
        
        .notification.error {
            border-left: 4px solid var(--error-color);
        }
        
        .notification.warning {
            border-left: 4px solid var(--warning-color);
        }
        
        .notification.info {
            border-left: 4px solid var(--primary-color);
        }
        
        .notification-icon {
            font-size: 18px;
        }
        
        .notification.success .notification-icon {
            color: var(--success-color);
        }
        
        .notification.error .notification-icon {
            color: var(--error-color);
        }
        
        .notification.warning .notification-icon {
            color: var(--warning-color);
        }
        
        .notification.info .notification-icon {
            color: var(--primary-color);
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }
        
        .notification-message {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .notification-close {
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.2s ease;
        }
        
        .notification-close:hover {
            color: var(--text-primary);
        }
        
        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }
        
        .fade-out {
            animation: fadeOut 0.3s ease forwards;
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 24px;
            }
            
            .subject-selection {
                grid-template-columns: 1fr;
            }
            
            .mode-selection {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .progress-charts {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 16px;
            }
            
            .nav-tabs {
                padding: 0 16px;
                overflow-x: auto;
            }
            
            .main-content {
                padding: 16px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .notification {
                min-width: 280px;
            }
            
            .notification-container {
                left: 20px;
                right: 20px;
            }
        }
    
@keyframes bounceIn {
    0% { transform: scale(0.5); opacity: 0; }
    60% { transform: scale(1.1); opacity: 1; }
    100% { transform: scale(1); }
}

.bounce-in {
    animation: bounceIn 0.4s ease forwards;
}

/* Special styling for settings section */
#settings-section {
    grid-template-columns: 1fr;
    display: grid;
}

#settings-section .study-area {
    width: 100%;
    max-width: 800px;
}

#settings-section .settings-container {
    padding: 32px;
}

.sidebar {
</style>
</head>
<body data-theme="light">
<div class="notification-container" id="notification-container"></div>
<div class="container">
</style>
</head>
<body data-theme="light">
<div class="notification-container" id="notification-container"></div>
<div class="container">
<div class="header">
<div class="header-content">
<h1>Science Revise</h1>
<div class="header-actions">
<span style="opacity: 0.9; font-size: 14px;">Science Study Platform</span>
</div>
</div>
</div>
<div class="nav-tabs">
<button class="nav-tab active" id="home-tab" data-section="home" onclick="resetToHome()">
Home
            </button>
<button class="nav-tab" id="settings-tab" data-section="settings">Settings</button>
</div>
<!-- Home Section -->
<div class="main-content" id="home-section">
<div class="study-area">
<div class="streak-banner" style="background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); color: white; padding: 16px; border-radius: 8px; margin-bottom: 24px; text-align: center;">
<div style="font-size: 14px; margin-bottom: 4px;">Current Study Streak</div>
<div style="font-size: 32px; font-weight: bold;" id="home-study-streak">0</div>
<div style="font-size: 12px; opacity: 0.8;">days in a row</div>
</div>

<div class="subject-selection" id="subject-selection">
<div class="subject-card" data-subject="chemistry">
<div class="subject-icon">
<i class="fas fa-flask"></i>
</div>
<h3>Chemistry</h3>
<p>Atoms, Molecules &amp; Reactions</p>
</div>
<div class="subject-card" data-subject="physics">
<div class="subject-icon">
<i class="fas fa-atom"></i>
</div>
<h3>Physics</h3>
<p>Forces, Energy &amp; Motion</p>
</div>
<div class="subject-card" data-subject="biology">
<div class="subject-icon">
<i class="fas fa-dna"></i>
</div>
<h3>Biology</h3>
<p>Life, Cells &amp; Evolution</p>
</div>
</div>

<div class="section-content hidden" id="topic-selection">
<div class="section-header">
<h3>Select Topics to Study</h3>
</div>
<div style="padding: 24px;">
<div class="topic-grid" id="topic-grid"></div>
<div class="button-group">
<button class="btn" id="select-all-btn">Select All</button>
<button class="btn" id="clear-all-btn">Clear All</button>
<button class="btn btn-primary" id="study-btn">
<i class="fas fa-play" style="margin-right: 8px;"></i>Study
                            </button>
</div>
</div>
</div>

<div class="section-content hidden" id="mode-selection-container">
<div class="section-header">
<h3>Choose Study Mode</h3>
</div>
<div style="padding: 24px;">
<div class="mode-selection">
<div class="mode-card" data-mode="quiz">
<div class="mode-icon">
<i class="fas fa-question-circle"></i>
</div>
<h4>Smart Quiz</h4>
<p>Multiple choice questions</p>
</div>
<div class="mode-card" data-mode="terms">
<div class="mode-icon">
<i class="fas fa-book-open"></i>
</div>
<h4>Smart Terms</h4>
<p>Define key concepts</p>
</div>
<div class="mode-card" data-mode="exam">
<div class="mode-icon">
<i class="fas fa-graduation-cap"></i>
</div>
<h4>Exam Questions</h4>
<p>With Typing & Marking</p>
</div>
</div>
</div>
</div>
</div>

<div class="analytics-section study-area" style="margin-top: 32px; background: var(--bg-primary); border-radius: 16px; border: 1px solid var(--border-color); padding: 24px;">
    <h3 style="margin-bottom: 24px; display: flex; align-items: center;">
        <i class="fas fa-chart-line" style="margin-right: 12px; color: var(--primary-color);"></i>Progress Overview
    </h3>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px; margin-bottom: 24px;">
        <div class="stats-card" style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: var(--primary-color); margin-bottom: 8px;" id="home-avg-score">0%</div>
            <div style="font-size: 14px; color: var(--text-secondary);">Average Score</div>
        </div>
        <div class="stats-card" style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: var(--success-color); margin-bottom: 8px;" id="home-total-questions">0</div>
            <div style="font-size: 14px; color: var(--text-secondary);">Questions Answered</div>
        </div>
        <div class="stats-card" style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: var(--warning-color); margin-bottom: 8px;" id="home-topics-mastered">0</div>
            <div style="font-size: 14px; color: var(--text-secondary);">Topics Mastered</div>
        </div>
    </div>

    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
        <h4 style="font-size: 16px;">Mastery Progress</h4>
        <span style="font-size: 14px; color: var(--text-secondary);">Updated today</span>
    </div>
    
    <div id="home-mastery-progress" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px;">
        <!-- Will be populated dynamically -->
        <div style="text-align: center; color: var(--text-secondary); padding: 20px; grid-column: 1/-1;">
            Start studying to see your progress here!
        </div>
    </div>
</div>

<!-- Question Container -->
<div class="hidden" id="question-section">
<div class="streak-counter" style="background: var(--primary-color); color: white; padding: 10px 16px; border-radius: 8px; margin-bottom: 20px; display: flex; justify-content: center; align-items: center; font-weight: bold;">
<span>Current Streak: </span><span id="streak-count" style="margin-left: 8px; font-size: 20px;">0</span>
</div>
<div class="question-progress" style="height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden; margin-bottom: 20px;">
<div id="question-progress-bar" style="height: 100%; width: 0%; background: var(--error-color);"></div>
</div>
<div class="score-display" style="text-align: right; margin-bottom: 10px; font-size: 14px; color: var(--text-secondary);">
Score: <span id="correct-count">0</span>
</div>
<div class="question-container">
<div class="question-text" id="question-text"></div>
<div class="options-grid" id="options-container"></div>
<div id="feedback-container"></div>
<div class="controls">
<button class="btn" id="prev-btn">
<i class="fas fa-chevron-left" style="margin-right: 8px;"></i>Previous
                            </button>
<div class="progress-info">
<span id="progress-text"></span>
</div>
<button class="btn btn-primary" id="next-btn">
                                Next<i class="fas fa-chevron-right" style="margin-left: 8px;"></i>
</button>
</div>
</div>
</div>
<!-- Terms Container -->
<div class="terms-container hidden" id="terms-section">
<div class="streak-counter" style="background: var(--primary-color); color: white; padding: 10px 16px; border-radius: 8px; margin-bottom: 20px; display: flex; justify-content: center; align-items: center; font-weight: bold;">
<span>Term Mastery</span>
</div>
<div class="term-progress" style="height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden; margin-bottom: 20px;">
<div id="term-progress-bar" style="height: 100%; width: 0%; background: var(--error-color);"></div>
</div>

<div class="term-text" id="term-text"></div>
<textarea class="definition-input" id="definition-input" placeholder="Write your definition here..."></textarea>
<div class="button-group">
<button class="btn btn-primary" id="show-def-btn">
<i class="fas fa-eye" style="margin-right: 8px;"></i>Show Answer
                        </button>
</div>
<div id="term-feedback"></div>
<div class="rating-buttons hidden" id="rating-buttons">
<button class="rating-btn hard" data-rating="hard">
<i class="fas fa-times" style="margin-right: 8px;"></i>Hard
                        </button>
<button class="rating-btn medium" data-rating="medium">
<i class="fas fa-minus" style="margin-right: 8px;"></i>Medium
                        </button>
<button class="rating-btn easy" data-rating="easy">
<i class="fas fa-check" style="margin-right: 8px;"></i>Easy
                        </button>
</div>
<div class="controls">
<button class="btn" id="prev-term-btn">
<i class="fas fa-chevron-left" style="margin-right: 8px;"></i>Previous
                        </button>
<div class="progress-info">
<span id="term-progress"></span>
</div>
<button class="btn btn-primary" id="next-term-btn">
                            Next<i class="fas fa-chevron-right" style="margin-left: 8px;"></i>
</button>
</div>
</div>
</div>
<div class="sidebar">
</div>
</div>
</div>

<!-- Reports Section -->
<div class="main-content hidden" id="reports-section">
<div class="study-area">
<div class="progress-overview">
<div class="section-header" style="margin: -32px -32px 32px -32px;">
<h3><i class="fas fa-chart-line" style="margin-right: 12px;"></i>Progress Overview</h3>
</div>
<div class="progress-charts">
<div class="chart-container">
<div class="chart-title">Smart Quiz</div>
<canvas height="200" id="quizChart" width="200"></canvas>
<div style="margin-top: 12px; font-size: 14px; color: var(--text-secondary);">
                                Last attempt: <span id="quiz-last-attempt">Not started</span>
</div>
</div>
<div class="chart-container">
<div class="chart-title">Smart Terms</div>
<canvas height="200" id="termsChart" width="200"></canvas>
<div style="margin-top: 12px; font-size: 14px; color: var(--text-secondary);">
                                Last attempt: <span id="terms-last-attempt">Not started</span>
</div>
</div>
<div class="chart-container">
<div class="chart-title">Smart Advance</div>
<canvas height="200" id="advanceChart" width="200"></canvas>
<div style="margin-top: 12px; font-size: 14px; color: var(--text-secondary);">
                                Last attempt: <span id="advance-last-attempt">Not started</span>
</div>
</div>
</div>
<div class="mastery-grid" id="mastery-grid"></div>
</div>
</div>
<div class="sidebar">
<div class="sidebar-section">
<div class="sidebar-header">
<h3>Overall Stats</h3>
</div>
<div class="sidebar-content">
<div style="display: grid; gap: 16px;">
<div>
<div id="avg-score" style="font-size: 24px; font-weight: 700; color: var(--primary-color);">0%</div>
<div style="font-size: 12px; color: var(--text-secondary);">Average Score</div>
</div>
<div>
<div id="total-questions" style="font-size: 24px; font-weight: 700; color: var(--success-color);">0</div>
<div style="font-size: 12px; color: var(--text-secondary);">Questions Answered</div>
</div>
<div>
<div id="topics-mastered" style="font-size: 24px; font-weight: 700; color: var(--warning-color);">0</div>
<div style="font-size: 12px; color: var(--text-secondary);">Topics Mastered</div>
</div>
</div>
</div>
</div>
<div class="sidebar-section">
<div class="sidebar-header">
<h3>Study Streak</h3>
</div>
<div class="sidebar-content">
<div id="study-streak" style="font-size: 32px; font-weight: 700; color: var(--warning-color); margin-bottom: 8px;">0</div>
<div style="font-size: 14px; color: var(--text-secondary);">Days in a row</div>
<div style="margin-top: 16px; font-size: 12px; color: var(--text-secondary);">
                            Keep studying to maintain your streak!
                        </div>
</div>
</div>
</div>
</div>
<!-- Settings Section -->
<div class="main-content hidden" id="settings-section" style="grid-template-columns: 1fr; max-width: 1000px; margin: 0 auto;">
<div class="study-area" style="width: 100%; margin: 0 auto;">
<div class="settings-container" style="padding: 32px;">
<div class="section-header" style="margin: -32px -32px 32px -32px;">
<h3><i class="fas fa-cog" style="margin-right: 12px;"></i>Settings</h3>
</div>
<div class="setting-item">
<div>
<div class="setting-label">Dark Mode</div>
<div class="setting-description">Switch between light and dark themes</div>
</div>
<div class="toggle-switch" id="theme-toggle"></div>
</div>
<div class="setting-item">
<div>
<div class="setting-label">Auto Progress</div>
<div class="setting-description">Automatically advance to next question after answering</div>
</div>
<div class="toggle-switch" id="auto-progress-toggle"></div>
</div>
<div class="setting-item">
<div>
<div class="setting-label">Sound Effects</div>
<div class="setting-description">Play sounds for correct/incorrect answers</div>
</div>
<div class="toggle-switch active" id="sound-toggle"></div>
</div>
<div class="setting-item">
<div>
<div class="setting-label">Shuffle Questions</div>
<div class="setting-description">Randomize question order in study sessions</div>
</div>
<div class="toggle-switch active" id="shuffle-toggle"></div>
</div>
<div class="setting-item">
<div>
<div class="setting-label">Show Immediate Feedback</div>
<div class="setting-description">Display answer feedback right after selection</div>
</div>
<div class="toggle-switch active" id="feedback-toggle"></div>
</div>
<div style="margin-top: 32px; padding-top: 32px; border-top: 1px solid var(--border-color);">
<h4 style="margin-bottom: 16px; color: var(--text-primary);">Data Management</h4>
<div class="button-group">
<button class="btn" id="export-btn">
<i class="fas fa-download" style="margin-right: 8px;"></i>Export Data
                            </button>
<button class="btn" id="import-btn">
<i class="fas fa-upload" style="margin-right: 8px;"></i>Import Data
                            </button>
<button class="btn" id="reset-progress-btn" style="background: var(--warning-color); color: white; border-color: var(--warning-color);">
<i class="fas fa-refresh" style="margin-right: 8px;"></i>Reset Progress
                            </button>
<button class="btn" id="clear-data-btn" style="background: var(--error-color); color: white; border-color: var(--error-color);">
<i class="fas fa-trash" style="margin-right: 8px;"></i>Clear All Data
                            </button>
</div>
</div>
<input accept=".json" id="import-file" style="display: none;" type="file"/>
</div>
</div>
</div>

<script>
        // Sample question data with subtopics
        const questionData = {
            chemistry: {
            "1. Key concepts in chemistry": {
                "subtopics": {
                "Atomic structure": {
                    "quiz": [
                    {
                        "question": "Who proposed the Dalton model of the atom?",
                        "options": ["John Dalton", "J.J. Thomson", "Ernest Rutherford", "Niels Bohr"],
                        "correct": 0
                    },
                    {
                        "question": "What particles are found in the nucleus of an atom?",
                        "options": ["Protons and electrons", "Protons and neutrons", "Electrons and neutrons", "Only protons"],
                        "correct": 1
                    },
                    {
                        "question": "What is the relative charge of an electron?",
                        "options": ["+1", "0", "-1"],
                        "correct": 2
                    },
                    {
                        "question": "Why do atoms contain equal numbers of protons and electrons?",
                        "options": ["To balance electric charge", "To have the same mass", "To create ions"],
                        "correct": 0
                    },
                    {
                        "question": "Where is most of the mass of an atom concentrated?",
                        "options": ["Electron cloud", "Nucleus", "Shells", "Proton"],
                        "correct": 1
                    },
                    {
                        "question": "What is the mass number of an atom?",
                        "options": ["Number of protons", "Number of neutrons", "Sum of protons and neutrons"],
                        "correct": 2
                    },
                    {
                        "question": "What distinguishes isotopes of the same element?",
                        "options": ["Different number of protons", "Different number of neutrons", "Different number of electrons"],
                        "correct": 1
                    }
                    ],
                    "terms": [
                    {
                        "term": "Proton",
                        "definition": "A subatomic particle with relative charge +1 and relative mass 1."
                    },
                    {
                        "term": "Neutron",
                        "definition": "A subatomic particle with no charge and relative mass 1."
                    },
                    {
                        "term": "Electron",
                        "definition": "A subatomic particle with relative charge -1 and negligible mass."
                    },
                    {
                        "term": "Isotope",
                        "definition": "Atoms of the same element with the same number of protons but different numbers of neutrons."
                    }
                    ],
                    "exam": []
                },
                "The periodic table": {
                    "quiz": [
                    {
                        "question": "Who arranged the elements in the first periodic table?",
                        "options": ["Dmitri Mendeleev", "John Dalton", "Henry Moseley", "Marie Curie"],
                        "correct": 0
                    },
                    {
                        "question": "What property did Mendeleev use to arrange the elements?",
                        "options": ["Atomic number", "Relative atomic mass", "Melting point", "Density"],
                        "correct": 1
                    },
                    {
                        "question": "What did Mendeleev predict using his periodic table?",
                        "options": ["Existence and properties of undiscovered elements", "Atomic masses of known elements", "Chemical formulae", "Bond types"],
                        "correct": 0
                    },
                    {
                        "question": "Elements in the same group have similar what?",
                        "options": ["Atomic masses", "Physical states", "Properties", "Neutrons"],
                        "correct": 2
                    },
                    {
                        "question": "What does the atomic number represent?",
                        "options": ["Number of neutrons", "Number of protons", "Mass number", "Number of electrons"],
                        "correct": 1
                    },
                    {
                        "question": "How are metals and non-metals arranged in the periodic table?",
                        "options": ["Metals on left, non-metals on right", "Non-metals on left, metals on right", "Mixed randomly", "Grouped by color"],
                        "correct": 0
                    },
                    {
                        "question": "What is the electronic configuration of oxygen (atomic number 8)?",
                        "options": ["2.6", "2.8", "2.4", "8"],
                        "correct": 0
                    }
                    ],
                    "terms": [
                    {
                        "term": "Atomic number",
                        "definition": "The number of protons in the nucleus of an atom, defining the element."
                    },
                    {
                        "term": "Group",
                        "definition": "Vertical columns in the periodic table with elements having similar properties."
                    },
                    {
                        "term": "Period",
                        "definition": "Horizontal rows in the periodic table indicating the number of electron shells."
                    }
                    ],
                    "exam": []
                },
                "Ionic bonding": {
                    "quiz": [
                    {
                        "question": "How are ionic bonds formed?",
                        "options": ["Sharing electrons", "Transfer of electrons", "Mixing atoms", "Breaking bonds"],
                        "correct": 1
                    },
                    {
                        "question": "What is an ion?",
                        "options": ["An atom with a positive or negative charge", "A neutral atom", "A molecule", "An isotope"],
                        "correct": 0
                    },
                    {
                        "question": "What charge does a sodium ion have after bonding?",
                        "options": ["+1", "-1", "0", "+2"],
                        "correct": 0
                    },
                    {
                        "question": "What is the formula of the ionic compound formed between sodium and chlorine?",
                        "options": ["NaCl", "NaCl2", "Na2Cl", "ClNa2"],
                        "correct": 0
                    },
                    {
                        "question": "What kind of structure do ionic compounds have?",
                        "options": ["Giant lattice", "Simple molecules", "Metallic lattice", "Polymer chains"],
                        "correct": 0
                    },
                    {
                        "question": "Why do ionic compounds have high melting points?",
                        "options": ["Strong electrostatic forces between ions", "Weak bonds", "Molecules repel", "Low mass"],
                        "correct": 0
                    },
                    {
                        "question": "Do ionic compounds conduct electricity when solid?",
                        "options": ["No", "Yes", "Sometimes", "Only metals do"],
                        "correct": 0
                    }
                    ],
                    "terms": [
                    {
                        "term": "Ionic bond",
                        "definition": "A bond formed by the transfer of electrons from a metal to a non-metal forming ions."
                    },
                    {
                        "term": "Cation",
                        "definition": "A positively charged ion formed by loss of electrons."
                    },
                    {
                        "term": "Anion",
                        "definition": "A negatively charged ion formed by gain of electrons."
                    }
                    ],
                    "exam": []
                },
                "Covalent bonding": {
                    "quiz": [
                    {
                        "question": "How is a covalent bond formed?",
                        "options": ["Transfer of electrons", "Sharing a pair of electrons", "Ionic attraction", "Metallic bonding"],
                        "correct": 1
                    },
                    {
                        "question": "What type of substances do covalent bonds form?",
                        "options": ["Ionic compounds", "Simple molecules", "Metallic structures", "Giant lattices"],
                        "correct": 1
                    },
                    {
                        "question": "Which of these molecules contains covalent bonds?",
                        "options": ["Water", "Sodium chloride", "Magnesium oxide", "Copper"],
                        "correct": 0
                    },
                    {
                        "question": "What is the typical size of atoms and small molecules?",
                        "options": ["Nanometers", "Centimeters", "Meters", "Millimeters"],
                        "correct": 0
                    },
                    {
                        "question": "How many covalent bonds does methane (CH4) have?",
                        "options": ["4", "2", "1", "0"],
                        "correct": 0
                    },
                    {
                        "question": "Which diagram shows covalent bonding?",
                        "options": ["Dot and cross diagram", "Ball and stick", "Both", "None"],
                        "correct": 2
                    }
                    ],
                    "terms": [
                    {
                        "term": "Covalent bond",
                        "definition": "A chemical bond formed by sharing a pair of electrons between atoms."
                    },
                    {
                        "term": "Molecule",
                        "definition": "A group of atoms held together by covalent bonds."
                    }
                    ],
                    "exam": []
                },
                "Types of substances and their properties": {
                    "quiz": [
                    {
                        "question": "Which type of bonding has high melting and boiling points?",
                        "options": ["Ionic", "Simple covalent", "Metallic", "All of these"],
                        "correct": 0
                    },
                    {
                        "question": "Why do ionic compounds conduct electricity when molten?",
                        "options": ["Ions are free to move", "Electrons move freely", "Ions are fixed", "No conduction occurs"],
                        "correct": 0
                    },
                    {
                        "question": "Graphite is used in electrodes because it:",
                        "options": ["Conducts electricity", "Is very hard", "Is a good insulator", "Has a high melting point"],
                        "correct": 0
                    },
                    {
                        "question": "Diamond is used in cutting tools because it:",
                        "options": ["Is very hard", "Conducts electricity", "Is soft", "Is flexible"],
                        "correct": 0
                    },
                    {
                        "question": "What is a polymer?",
                        "options": ["A large molecule made from repeating units", "A metal", "An ion", "A small molecule"],
                        "correct": 0
                    },
                    {
                        "question": "Which of these is a giant covalent structure?",
                        "options": ["Diamond", "Water", "Methane", "Sodium chloride"],
                        "correct": 0
                    },
                    {
                        "question": "Metals conduct electricity because they have:",
                        "options": ["Delocalised electrons", "Ions", "Protons", "Neutrons"],
                        "correct": 0
                    }
                    ],
                    "terms": [
                    {
                        "term": "Giant covalent structure",
                        "definition": "A structure made up of many atoms covalently bonded in a continuous network."
                    },
                    {
                        "term": "Polymer",
                        "definition": "A large molecule formed by many small units (monomers) joined together."
                    },
                    {
                        "term": "Metallic bonding",
                        "definition": "Bonding in metals where delocalised electrons hold positive ions together."
                    }
                    ],
                    "exam": []
                },
                "Calculations involving masses and moles": {
                    "quiz": [
                    {
                        "question": "How do you calculate relative formula mass?",
                        "options": ["Add relative atomic masses of all atoms in the formula", "Multiply atomic numbers", "Add mass numbers", "Multiply by Avogadro's number"],
                        "correct": 0
                    },
                    {
                        "question": "What is the formula of a compound if it contains 2 moles of hydrogen and 1 mole of oxygen?",
                        "options": ["H2O", "HO", "H2O2", "O2H2"],
                        "correct": 0
                    },
                    {
                        "question": "What is one mole of a substance?",
                        "options": ["6.02  10^23 particles", "1 gram", "Number of protons", "Relative atomic mass"],
                        "correct": 0
                    },
                    {
                        "question": "How do you calculate the number of moles from mass?",
                        "options": ["Mass  relative formula mass", "Mass  relative formula mass", "Mass + relative formula mass", "Mass - relative formula mass"],
                        "correct": 0
                    },
                    {
                        "question": "What is the Avogadro constant?",
                        "options": ["6.02  10^23", "3.14", "9.81", "1.67  10^-27"],
                        "correct": 0
                    },
                    {
                        "question": "What law states that mass is conserved in a chemical reaction?",
                        "options": ["Law of conservation of mass", "Law of definite proportions", "Law of multiple proportions", "Boyle's law"],
                        "correct": 0
                    }
                    ],
                    "terms": [
                    {
                        "term": "Relative atomic mass",
                        "definition": "The weighted average mass of the isotopes of an element compared to 1/12th of the mass of carbon-12."
                    },
                    {
                        "term": "Empirical formula",
                        "definition": "The simplest whole-number ratio of atoms of each element in a compound."
                    },
                    {
                        "term": "Mole",
                        "definition": "The amount of substance containing 6.02  10^23 particles."
                    }
                    ],
                    "exam": []
                }
                }
            },
            "2. States of matter and mixtures": {
                "subtopics": {
                "States of matter": {
                    "quiz": [
                    {
                        "question": "How are particles arranged in a solid?",
                        "options": ["Closely packed in a fixed pattern", "Spread far apart and moving freely", "Close but able to slide past each other", "Randomly arranged"],
                        "correct": 0
                    },
                    {
                        "question": "What is the movement of particles in a gas?",
                        "options": ["Vibrating in fixed positions", "Sliding past each other", "Moving rapidly in all directions", "Stationary"],
                        "correct": 2
                    },
                    {
                        "question": "Which state of matter has particles with the highest relative energy?",
                        "options": ["Solid", "Liquid", "Gas"],
                        "correct": 2
                    },
                    {
                        "question": "What is the term for the change from liquid to gas?",
                        "options": ["Melting", "Freezing", "Evaporation", "Condensation"],
                        "correct": 2
                    },
                    {
                        "question": "Which process is a physical change: melting or burning?",
                        "options": ["Melting", "Burning", "Both", "Neither"],
                        "correct": 0
                    },
                    {
                        "question": "During melting, what happens to the arrangement of particles?",
                        "options": ["They become more closely packed", "They break free from fixed positions", "They move more slowly", "They form a gas"],
                        "correct": 1
                    },
                    {
                        "question": "How would you predict the state of a substance at room temperature if its melting point is 50C and boiling point is 150C?",
                        "options": ["Solid", "Liquid", "Gas"],
                        "correct": 1
                    }
                    ],
                    "terms": [
                    {
                        "term": "Melting",
                        "definition": "The physical change of a substance from a solid to a liquid."
                    },
                    {
                        "term": "Boiling",
                        "definition": "The physical change of a substance from a liquid to a gas."
                    },
                    {
                        "term": "Condensation",
                        "definition": "The physical change from a gas to a liquid."
                    },
                    {
                        "term": "Sublimation",
                        "definition": "The physical change of a substance directly from solid to gas without passing through the liquid state."
                    }
                    ],
                    "exam": []
                },
                "Methods of separating and purifying substances": {
                    "quiz": [
                    {
                        "question": "What is the difference between a pure substance and a mixture in chemistry?",
                        "options": ["Pure substances contain only one type of particle; mixtures contain two or more types", "Pure substances melt over a range of temperatures; mixtures have sharp melting points", "Mixtures are compounds; pure substances are elements", "There is no difference"],
                        "correct": 0
                    },
                    {
                        "question": "How can melting point data help distinguish a pure substance from a mixture?",
                        "options": ["Pure substances have sharp melting points; mixtures melt over a range", "Pure substances melt over a range; mixtures have sharp melting points", "Both melt sharply", "Neither melts"],
                        "correct": 0
                    },
                    {
                        "question": "Which technique separates substances based on different boiling points?",
                        "options": ["Simple distillation", "Filtration", "Crystallisation", "Paper chromatography"],
                        "correct": 0
                    },
                    {
                        "question": "What is the main difference between simple distillation and fractional distillation?",
                        "options": ["Fractional distillation separates mixtures of liquids with closer boiling points; simple distillation separates liquids from solids", "Simple distillation is for solids; fractional is for gases", "Both are the same", "Fractional distillation is slower"],
                        "correct": 0
                    },
                    {
                        "question": "Which technique would you use to separate an insoluble solid from a liquid?",
                        "options": ["Filtration", "Distillation", "Chromatography", "Crystallisation"],
                        "correct": 0
                    },
                    {
                        "question": "How does paper chromatography separate substances?",
                        "options": ["Substances move at different rates due to solubility and affinity to the stationary phase", "By boiling points", "By density", "By magnetic properties"],
                        "correct": 0
                    },
                    {
                        "question": "What is the stationary phase in paper chromatography?",
                        "options": ["The paper", "The solvent", "The mixture", "The container"],
                        "correct": 0
                    },
                    {
                        "question": "What does an Rf value represent in chromatography?",
                        "options": ["Ratio of distance travelled by substance to distance travelled by solvent", "Boiling point", "Density", "Concentration"],
                        "correct": 0
                    }
                    ],
                    "terms": [
                    {
                        "term": "Pure substance",
                        "definition": "A material made of only one type of particle with fixed melting and boiling points."
                    },
                    {
                        "term": "Mixture",
                        "definition": "A combination of two or more substances not chemically bonded together."
                    },
                    {
                        "term": "Filtration",
                        "definition": "A technique to separate insoluble solids from liquids."
                    },
                    {
                        "term": "Simple distillation",
                        "definition": "A method to separate a liquid from a solution by boiling and condensing."
                    },
                    {
                        "term": "Fractional distillation",
                        "definition": "A method to separate a mixture of liquids with different boiling points."
                    },
                    {
                        "term": "Crystallisation",
                        "definition": "A technique to separate a dissolved solid from a solution by forming crystals."
                    },
                    {
                        "term": "Paper chromatography",
                        "definition": "A method for separating mixtures of soluble substances based on their movement through paper."
                    },
                    {
                        "term": "Rf value",
                        "definition": "A ratio used to identify substances in chromatography, calculated as distance moved by substance divided by distance moved by solvent."
                    }
                    ],
                    "exam": []
                },
                "Water purification": {
                    "quiz": [
                    {
                        "question": "What process removes solid particles from water before chlorination?",
                        "options": ["Sedimentation and filtration", "Distillation", "Crystallisation", "Chromatography"],
                        "correct": 0
                    },
                    {
                        "question": "Why is chlorination used in water treatment?",
                        "options": ["To kill harmful microorganisms", "To remove solids", "To soften water", "To remove salts"],
                        "correct": 0
                    },
                    {
                        "question": "How can sea water be made potable?",
                        "options": ["Distillation", "Filtration", "Chromatography", "Crystallisation"],
                        "correct": 0
                    },
                    {
                        "question": "Why must water used in analysis contain no dissolved salts?",
                        "options": ["To avoid interference with results", "To make it taste better", "To improve conductivity", "To keep it clear"],
                        "correct": 0
                    }
                    ],
                    "terms": [
                    {
                        "term": "Sedimentation",
                        "definition": "The process where solids settle out of water due to gravity."
                    },
                    {
                        "term": "Filtration",
                        "definition": "Removing suspended solids by passing water through a filter."
                    },
                    {
                        "term": "Chlorination",
                        "definition": "Adding chlorine to water to kill bacteria and other pathogens."
                    },
                    {
                        "term": "Potable water",
                        "definition": "Water that is safe to drink."
                    }
                    ],
                    "exam": []
                },
                "Core practical: Investigate the composition of inks": {
                    "quiz": [
                    {
                        "question": "Which two techniques can be used to analyse ink composition?",
                        "options": ["Simple distillation and paper chromatography", "Filtration and crystallisation", "Fractional distillation and sedimentation", "Chromatography and crystallisation"],
                        "correct": 0
                    },
                    {
                        "question": "What does paper chromatography separate ink components based on?",
                        "options": ["Solubility and affinity for stationary phase", "Boiling point", "Density", "Colour only"],
                        "correct": 0
                    }
                    ],
                    "terms": [],
                    "exam": []
                }
                }
            },
            "3. Chemical changes": {
            "subtopics": {
            "Acids and alkalis": {
                "quiz": [
                {
                    "question": "What ions do acids release in solution?",
                    "options": ["Hydrogen ions (H+)", "Hydroxide ions (OH)", "Sodium ions (Na+)", "Chloride ions (Cl)"],
                    "correct": 0
                },
                {
                    "question": "What pH value is neutral?",
                    "options": ["7", "0", "14", "1"],
                    "correct": 0
                },
                {
                    "question": "What colour does litmus turn in an acid?",
                    "options": ["Red", "Blue", "Green", "Yellow"],
                    "correct": 0
                },
                {
                    "question": "If the hydrogen ion concentration increases by a factor of 10, what happens to the pH?",
                    "options": ["It decreases by 1", "It increases by 1", "It stays the same", "It doubles"],
                    "correct": 0
                },
                {
                    "question": "What is a strong acid?",
                    "options": ["An acid that fully dissociates into ions", "An acid that partially dissociates", "An acid with pH 7", "An acid that is diluted"],
                    "correct": 0
                },
                {
                    "question": "What is the general reaction of an acid with a metal carbonate?",
                    "options": ["Acid + metal carbonate  salt + water + carbon dioxide", "Acid + metal carbonate  salt + hydrogen gas", "Acid + metal carbonate  water only", "Acid + metal carbonate  salt only"],
                    "correct": 0
                },
                {
                    "question": "What gas is produced when acids react with metals?",
                    "options": ["Hydrogen", "Oxygen", "Carbon dioxide", "Nitrogen"],
                    "correct": 0
                },
                {
                    "question": "What ions react in an acid-alkali neutralisation?",
                    "options": ["H+ ions react with OH ions to form water", "Na+ ions react with Cl ions", "H+ ions react with CO3^2 ions", "OH ions react with CO2"],
                    "correct": 0
                }
                ],
                "terms": [
                {
                    "term": "Acid",
                    "definition": "A substance that produces hydrogen ions (H+) in aqueous solution."
                },
                {
                    "term": "Alkali",
                    "definition": "A soluble base that produces hydroxide ions (OH) in aqueous solution."
                },
                {
                    "term": "pH scale",
                    "definition": "A scale from 0 to 14 measuring how acidic or alkaline a solution is; 7 is neutral."
                },
                {
                    "term": "Neutralisation",
                    "definition": "A reaction between an acid and a base producing salt and water."
                },
                {
                    "term": "Strong acid",
                    "definition": "An acid that fully dissociates in solution."
                },
                {
                    "term": "Weak acid",
                    "definition": "An acid that partially dissociates in solution."
                }
                ],
                "exam": []
            },
            "Preparing salts and titrations": {
                "quiz": [
                {
                    "question": "Why is excess insoluble reactant added when preparing a salt?",
                    "options": ["To ensure all acid reacts", "To increase yield", "To change pH", "To produce gas"],
                    "correct": 0
                },
                {
                    "question": "Why must titration be used when both reactants are soluble?",
                    "options": ["To mix in correct proportions", "To heat the solution", "To cool the solution", "To change colour"],
                    "correct": 0
                },
                {
                    "question": "Which equipment is used to accurately measure volumes during titration?",
                    "options": ["Burette and pipette", "Beaker and funnel", "Test tube and stirring rod", "Measuring cylinder and spatula"],
                    "correct": 0
                },
                {
                    "question": "What is the indicator used in acid-alkali titration?",
                    "options": ["Phenolphthalein", "Methyl orange", "Litmus", "Bromothymol blue"],
                    "correct": 0
                },
                {
                    "question": "What is the final product when copper oxide reacts with sulfuric acid?",
                    "options": ["Copper sulfate", "Copper chloride", "Copper nitrate", "Copper carbonate"],
                    "correct": 0
                }
                ],
                "terms": [
                {
                    "term": "Titration",
                    "definition": "A method to find the exact volume of acid or alkali needed for neutralisation."
                },
                {
                    "term": "Salt",
                    "definition": "An ionic compound formed from the positive ion of a base and the negative ion of an acid."
                },
                {
                    "term": "Excess reactant",
                    "definition": "The reactant added in surplus to ensure complete reaction of the other reactant."
                }
                ],
                "exam": []
            },
            "Solubility rules and precipitates": {
                "quiz": [
                {
                    "question": "Which salts are generally soluble in water?",
                    "options": ["Sodium, potassium and ammonium salts", "Lead salts", "Barium salts", "Calcium salts"],
                    "correct": 0
                },
                {
                    "question": "Which common salts are generally insoluble?",
                    "options": ["Lead, barium and calcium sulfates", "Sodium, potassium salts", "Nitrates", "Ammonium salts"],
                    "correct": 0
                },
                {
                    "question": "What indicates a precipitate has formed?",
                    "options": ["A solid appears in solution", "Solution changes colour", "Gas is produced", "Temperature rises"],
                    "correct": 0
                },
                {
                    "question": "What is a precipitate?",
                    "options": ["An insoluble solid formed in a solution", "A gas formed", "A liquid formed", "A soluble salt"],
                    "correct": 0
                }
                ],
                "terms": [
                {
                    "term": "Precipitate",
                    "definition": "An insoluble solid formed when two solutions react."
                },
                {
                    "term": "Solubility",
                    "definition": "The ability of a substance to dissolve in a solvent."
                }
                ],
                "exam": []
            },
            "Electrolysis": {
                "quiz": [
                {
                    "question": "What is an electrolyte?",
                    "options": ["An ionic compound melted or dissolved in water that conducts electricity", "A metal", "A solvent", "An element"],
                    "correct": 0
                },
                {
                    "question": "In electrolysis, where do cations move?",
                    "options": ["To the cathode (negative electrode)", "To the anode (positive electrode)", "Randomly", "They don't move"],
                    "correct": 0
                },
                {
                    "question": "What is produced at the cathode during the electrolysis of copper sulfate with inert electrodes?",
                    "options": ["Copper metal", "Oxygen gas", "Hydrogen gas", "Chlorine gas"],
                    "correct": 0
                },
                {
                    "question": "What happens at the anode during electrolysis?",
                    "options": ["Oxidation occurs", "Reduction occurs", "No reaction", "Electrons are gained"],
                    "correct": 0
                },
                {
                    "question": "What is the purpose of using copper electrodes in copper sulfate electrolysis?",
                    "options": ["To purify copper by depositing pure copper on the cathode", "To generate hydrogen gas", "To produce oxygen gas", "To stop the reaction"],
                    "correct": 0
                }
                ],
                "terms": [
                {
                    "term": "Electrolysis",
                    "definition": "The breakdown of an ionic compound using electricity."
                },
                {
                    "term": "Cathode",
                    "definition": "The negative electrode where reduction occurs."
                },
                {
                    "term": "Anode",
                    "definition": "The positive electrode where oxidation occurs."
                },
                {
                    "term": "Oxidation",
                    "definition": "Loss of electrons."
                },
                {
                    "term": "Reduction",
                    "definition": "Gain of electrons."
                },
                {
                    "term": "Electrolyte",
                    "definition": "An ionic compound in molten or aqueous solution that conducts electricity."
                }
                ],
                "exam": []
            },
            "Core Practicals": {
                "quiz": [
                {
                    "question": "What does adding calcium hydroxide to hydrochloric acid do to the pH?",
                    "options": ["Increases pH, making the solution less acidic", "Decreases pH", "No change", "Makes solution neutral"],
                    "correct": 0
                },
                {
                    "question": "Which practical is used to prepare pure, dry hydrated copper sulfate crystals?",
                    "options": ["Reaction of copper oxide with sulfuric acid", "Electrolysis of copper sulfate", "Titration of acid and alkali", "Precipitation of insoluble salt"],
                    "correct": 0
                },
                {
                    "question": "Which practical investigates electrolysis with copper sulfate and inert electrodes?",
                    "options": ["Electrolysis of copper sulfate solution", "Paper chromatography", "Simple distillation", "Crystallisation"],
                    "correct": 0
                }
                ],
                "terms": [],
                "exam": []
            }
            }
        },
            "4. Extracting metals and equilibria": {
    "subtopics": {
      "Reactivity of metals": {
        "quiz": [
          {
            "question": "What type of reaction occurs when a metal displaces another metal from its salt solution?",
            "options": ["Displacement reaction", "Neutralisation", "Precipitation", "Combustion"],
            "correct": 0
          },
          {
            "question": "In displacement reactions, what happens to the metal atoms?",
            "options": ["They lose electrons and form cations", "They gain electrons and form anions", "They do not change", "They form molecules"],
            "correct": 0
          },
          {
            "question": "Which metal is most reactive among these: potassium, copper, gold?",
            "options": ["Potassium", "Copper", "Gold", "All equally reactive"],
            "correct": 0
          },
          {
            "question": "Why is hydrogen included in the reactivity series?",
            "options": ["To compare the reactivity of metals with hydrogen", "Because it is a metal", "Because it reacts with carbon", "It is the least reactive element"],
            "correct": 0
          }
        ],
        "terms": [
          {
            "term": "Reactivity series",
            "definition": "A list of metals in order of decreasing reactivity."
          },
          {
            "term": "Displacement reaction",
            "definition": "A reaction where a more reactive metal displaces a less reactive metal from its compound."
          },
          {
            "term": "Oxidation",
            "definition": "Loss of electrons or gain of oxygen."
          },
          {
            "term": "Reduction",
            "definition": "Gain of electrons or loss of oxygen."
          }
        ],
        "exam": []
      },
      "Extraction of metals": {
        "quiz": [
          {
            "question": "What is the main method to extract metals less reactive than carbon?",
            "options": ["Heating with carbon", "Electrolysis", "Distillation", "Crystallisation"],
            "correct": 0
          },
          {
            "question": "How are metals more reactive than carbon usually extracted?",
            "options": ["By electrolysis", "By heating with carbon", "By simple heating", "By precipitation"],
            "correct": 0
          },
          {
            "question": "Why are unreactive metals like gold found in their native state?",
            "options": ["Because they resist oxidation", "Because they dissolve easily", "Because they react with acids", "Because they are gases"],
            "correct": 0
          },
          {
            "question": "Which metal is extracted by electrolysis of its molten ore?",
            "options": ["Aluminium", "Iron", "Copper", "Gold"],
            "correct": 0
          },
          {
            "question": "What is phytoextraction?",
            "options": ["Using plants to extract metals from soil", "Extracting metals by heating", "Extracting metals by electrolysis", "Extracting metals by filtration"],
            "correct": 0
          }
        ],
        "terms": [
          {
            "term": "Ore",
            "definition": "A rock that contains enough metal compounds to make extraction worthwhile."
          },
          {
            "term": "Reduction",
            "definition": "The process of removing oxygen from a metal oxide to obtain the metal."
          },
          {
            "term": "Electrolysis",
            "definition": "The extraction of metals by passing an electric current through molten compounds."
          },
          {
            "term": "Phytoextraction",
            "definition": "Using plants to absorb metal compounds from the soil to be harvested."
          },
          {
            "term": "Life cycle assessment",
            "definition": "A study of the environmental impact of a product from raw materials to disposal."
          }
        ],
        "exam": []
      },
      "Environmental and economic considerations": {
        "quiz": [
          {
            "question": "Why is recycling metals beneficial?",
            "options": ["Saves energy and raw materials", "Increases mining", "Produces more waste", "Uses more electricity"],
            "correct": 0
          },
          {
            "question": "What does a life cycle assessment consider?",
            "options": [
              "Environmental impact of raw materials, manufacturing, use, and disposal",
              "Only the manufacturing process",
              "Only the use of the product",
              "Only disposal of the product"
            ],
            "correct": 0
          },
          {
            "question": "Which is NOT a stage in a life cycle assessment?",
            "options": ["Transportation of materials", "Manufacturing", "Use", "Changing the colour of product"],
            "correct": 3
          }
        ],
        "terms": [
          {
            "term": "Recycling",
            "definition": "Reprocessing used materials into new products."
          },
          {
            "term": "Life cycle assessment",
            "definition": "Evaluates the environmental impact of all stages of a products life."
          }
        ],
        "exam": []
      },
      "Core Practicals": {
        "quiz": [
          {
            "question": "What practical might you do to investigate oxidation and reduction?",
            "options": ["Burning elements in oxygen", "Distillation", "Paper chromatography", "Filtration"],
            "correct": 0
          },
          {
            "question": "What is a competition reaction between metals?",
            "options": ["A displacement reaction showing reactivity differences", "A reaction that produces gas", "An acid-base reaction", "A neutralisation reaction"],
            "correct": 0
          }
        ],
        "terms": [],
        "exam": []
      }
    }
  },
            "5. Separate chemistry 1": {
    "subtopics": {
      "Transition metals, alloys and corrosion": {
        "quiz": [
          {
            "question": "Which property is NOT typical of most transition metals?",
            "options": [
              "High melting point",
              "High density",
              "Formation of coloured compounds",
              "Low melting point"
            ],
            "correct": 3
          },
          {
            "question": "What causes the corrosion of metals?",
            "options": [
              "Oxidation",
              "Reduction",
              "Combustion",
              "Neutralisation"
            ],
            "correct": 0
          },
          {
            "question": "Which method is NOT used to prevent rusting of iron?",
            "options": [
              "Exclusion of oxygen",
              "Exclusion of water",
              "Sacrificial protection",
              "Heating with acid"
            ],
            "correct": 3
          },
          {
            "question": "Why are pure metals often alloyed?",
            "options": [
              "To increase strength",
              "To decrease density",
              "To lower melting point",
              "To make them less reactive"
            ],
            "correct": 0
          },
          {
            "question": "What is electroplating used for?",
            "options": [
              "Improve appearance and resistance to corrosion",
              "Increase electrical conductivity",
              "Extract metals from ores",
              "Produce alloys"
            ],
            "correct": 0
          }
        ],
        "terms": [
          {
            "term": "Transition metals",
            "definition": "Metals that form coloured compounds, have high melting points, high density and catalytic activity."
          },
          {
            "term": "Corrosion",
            "definition": "The oxidation of metals leading to their deterioration, e.g., rusting of iron."
          },
          {
            "term": "Sacrificial protection",
            "definition": "Using a more reactive metal to protect iron from rusting by corroding instead."
          },
          {
            "term": "Alloy",
            "definition": "A mixture of a metal with other elements to improve its properties, especially strength."
          },
          {
            "term": "Electroplating",
            "definition": "Coating an object with a thin layer of metal using electrolysis to improve appearance or corrosion resistance."
          }
        ],
        "exam": []
      },
      "Quantitative analysis": {
        "quiz": [
          {
            "question": "What units are used to express concentration in mol dm?",
            "options": [
              "Moles per cubic decimeter",
              "Grams per liter",
              "Moles per kilogram",
              "Grams per mole"
            ],
            "correct": 0
          },
          {
            "question": "In a titration, what is the purpose of the indicator?",
            "options": [
              "Show the end point of the reaction",
              "Speed up the reaction",
              "Neutralise the acid",
              "Separate the reactants"
            ],
            "correct": 0
          },
          {
            "question": "How do you calculate percentage yield?",
            "options": [
              "(Actual yield  Theoretical yield)  100",
              "(Theoretical yield  Actual yield)  100",
              "Actual yield  Theoretical yield",
              "Theoretical yield  Actual yield"
            ],
            "correct": 0
          },
          {
            "question": "What is atom economy?",
            "options": [
              "Percentage of reactants that become useful products",
              "Percentage yield of a reaction",
              "Mass of product formed",
              "Energy released in a reaction"
            ],
            "correct": 0
          },
          {
            "question": "What is the molar volume of any gas at room temperature and pressure (RTP)?",
            "options": [
              "24 dm",
              "22.4 dm",
              "1 dm",
              "100 dm"
            ],
            "correct": 0
          }
        ],
        "terms": [
          {
            "term": "Concentration",
            "definition": "Amount of solute (in moles) per dm of solution."
          },
          {
            "term": "Percentage yield",
            "definition": "The actual amount of product formed as a percentage of the theoretical maximum."
          },
          {
            "term": "Atom economy",
            "definition": "A measure of the efficiency of a reaction in terms of how much of the reactants end up as useful products."
          },
          {
            "term": "Molar volume",
            "definition": "The volume occupied by one mole of a gas at room temperature and pressure (24 dm)."
          },
          {
            "term": "Avogadro's law",
            "definition": "Equal volumes of gases at the same temperature and pressure contain equal numbers of molecules."
          }
        ],
        "exam": []
      },
      "Core practicals": {
        "quiz": [
          {
            "question": "What is the key skill in an acid-alkali titration practical?",
            "options": [
              "Using a burette and pipette accurately",
              "Heating the solution",
              "Measuring density",
              "Filtering the solution"
            ],
            "correct": 0
          },
          {
            "question": "What calculation can you perform after a titration?",
            "options": [
              "Calculate unknown concentration or volume",
              "Calculate boiling point",
              "Calculate melting point",
              "Calculate mass"
            ],
            "correct": 0
          }
        ],
        "terms": [],
        "exam": []
      }
    }
  },
            "6. Groups in the periodic table": {
    "subtopics": {
      "Group 1": {
        "quiz": [
          {
            "question": "Why are lithium, sodium and potassium classified as alkali metals?",
            "options": [
              "Because they are in Group 1 of the periodic table",
              "Because they are all gases",
              "Because they have high melting points",
              "Because they are noble gases"
            ],
            "correct": 0
          },
          {
            "question": "Which property is typical of alkali metals?",
            "options": [
              "They are soft",
              "They have high melting points",
              "They are very dense",
              "They are unreactive"
            ],
            "correct": 0
          },
          {
            "question": "What happens when potassium reacts with water?",
            "options": [
              "It produces hydrogen gas and a metal hydroxide",
              "It produces oxygen gas",
              "It produces water",
              "It does not react"
            ],
            "correct": 0
          },
          {
            "question": "How does reactivity change down Group 1?",
            "options": [
              "It increases down the group",
              "It decreases down the group",
              "It stays the same",
              "It changes randomly"
            ],
            "correct": 0
          },
          {
            "question": "What explains the increase in reactivity down Group 1?",
            "options": [
              "Electrons are more easily lost due to increased atomic radius",
              "Electrons are harder to remove",
              "Atoms get smaller",
              "More protons in the nucleus"
            ],
            "correct": 0
          }
        ],
        "terms": [
          {
            "term": "Alkali metals",
            "definition": "Elements in Group 1 of the periodic table that are soft, have low melting points, and react vigorously with water."
          },
          {
            "term": "Reactivity",
            "definition": "How easily an element undergoes a chemical reaction."
          }
        ],
        "exam": []
      },
      "Group 7": {
        "quiz": [
          {
            "question": "What is the physical state of bromine at room temperature?",
            "options": [
              "Liquid",
              "Gas",
              "Solid",
              "Plasma"
            ],
            "correct": 0
          },
          {
            "question": "Which test is used to identify chlorine gas?",
            "options": [
              "Bleaches damp blue litmus paper",
              "Turns red litmus paper blue",
              "Produces a white precipitate",
              "Turns water red"
            ],
            "correct": 0
          },
          {
            "question": "What type of compounds do halogens form with metals?",
            "options": [
              "Metal halides",
              "Metal oxides",
              "Metal sulfides",
              "Metal nitrates"
            ],
            "correct": 0
          },
          {
            "question": "What happens in a displacement reaction between chlorine and bromide ions?",
            "options": [
              "Chlorine displaces bromine from the solution",
              "Bromine displaces chlorine from the solution",
              "No reaction occurs",
              "They combine to form a new compound"
            ],
            "correct": 0
          },
          {
            "question": "Why are displacement reactions considered redox reactions?",
            "options": [
              "Because one species is oxidised and another is reduced",
              "Because only electrons are shared",
              "Because no electrons are transferred",
              "Because only heat is involved"
            ],
            "correct": 0
          }
        ],
        "terms": [
          {
            "term": "Halogens",
            "definition": "Group 7 elements that exist as diatomic molecules and form salts with metals."
          },
          {
            "term": "Displacement reaction",
            "definition": "A reaction where a more reactive halogen displaces a less reactive halide ion from solution."
          },
          {
            "term": "Redox reaction",
            "definition": "A reaction involving the transfer of electrons where oxidation and reduction occur."
          }
        ],
        "exam": []
      },
      "Group 0": {
        "quiz": [
          {
            "question": "Why are noble gases chemically inert?",
            "options": [
              "They have full outer electron shells",
              "They have no electrons",
              "They have incomplete electron shells",
              "They easily lose electrons"
            ],
            "correct": 0
          },
          {
            "question": "Which property of noble gases makes them useful for filling light bulbs?",
            "options": [
              "Non-flammability",
              "High density",
              "High reactivity",
              "Strong smell"
            ],
            "correct": 0
          },
          {
            "question": "What is the trend in physical properties of noble gases down the group?",
            "options": [
              "Increase in boiling and melting points",
              "Decrease in boiling and melting points",
              "No change",
              "Become more reactive"
            ],
            "correct": 0
          }
        ],
        "terms": [
          {
            "term": "Noble gases",
            "definition": "Group 0 elements that are inert due to full outer shells, have low density and are non-flammable."
          },
          {
            "term": "Inertness",
            "definition": "Lack of chemical reactivity due to stable electronic configuration."
          }
        ],
        "exam": []
      },
      "Suggested practicals": {
        "quiz": [],
        "terms": [],
        "exam": []
      }
    }
  },
            "7. Rates of reaction and energy changes": {
    "subtopics": {
      "Rates of reaction": {
        "quiz": [
          {
            "question": "What is measured to determine the rate of reaction between hydrochloric acid and marble chips?",
            "options": [
              "The volume of gas produced",
              "The temperature increase",
              "The pH level",
              "The mass of the reactants"
            ],
            "correct": 0
          },
          {
            "question": "What is observed in the reaction between sodium thiosulfate and hydrochloric acid?",
            "options": [
              "Colour change",
              "Gas release",
              "Mass decrease",
              "pH change"
            ],
            "correct": 0
          },
          {
            "question": "What happens when the temperature of a reaction is increased?",
            "options": [
              "The particles collide more frequently and with more energy",
              "The reaction slows down",
              "The mass of the reactants increases",
              "The concentration decreases"
            ],
            "correct": 0
          },
          {
            "question": "Which of the following does NOT increase the rate of a reaction?",
            "options": [
              "Lower temperature",
              "Higher concentration",
              "Increased surface area",
              "Higher pressure (for gases)"
            ],
            "correct": 0
          },
          {
            "question": "How does a catalyst speed up a reaction?",
            "options": [
              "It lowers the activation energy required",
              "It increases the temperature",
              "It becomes part of the final products",
              "It increases the mass of reactants"
            ],
            "correct": 0
          },
          {
            "question": "What are enzymes?",
            "options": [
              "Biological catalysts",
              "Acids",
              "Proteins that slow reactions",
              "Reactants"
            ],
            "correct": 0
          },
          {
            "question": "How can rate of reaction be determined from a graph?",
            "options": [
              "By calculating the gradient",
              "By measuring the area under the curve",
              "By drawing a straight line",
              "By counting the number of data points"
            ],
            "correct": 0
          }
        ],
        "terms": [
          {
            "term": "Rate of reaction",
            "definition": "The speed at which reactants are converted into products in a chemical reaction."
          },
          {
            "term": "Collision theory",
            "definition": "The theory that reactions occur when particles collide with sufficient energy and proper orientation."
          },
          {
            "term": "Catalyst",
            "definition": "A substance that speeds up a chemical reaction without being used up or chemically changed."
          },
          {
            "term": "Activation energy",
            "definition": "The minimum amount of energy required for a reaction to occur."
          },
          {
            "term": "Enzyme",
            "definition": "A biological catalyst that speeds up reactions in living organisms."
          }
        ],
        "exam": []
      },
      "Suggested practicals": {
        "quiz": [],
        "terms": [],
        "exam": []
      }
    }
  },
            "8. Fuels and Earth science": {
    "subtopics": {
      "Fuels": {
        "quiz": [
          {
            "question": "What elements are found in hydrocarbons?",
            "options": [
              "Carbon and oxygen",
              "Carbon and hydrogen",
              "Carbon, hydrogen, and nitrogen",
              "Carbon, hydrogen, and sulfur"
            ],
            "correct": 1
          },
          {
            "question": "What process is used to separate crude oil into fractions?",
            "options": [
              "Filtration",
              "Cracking",
              "Fractional distillation",
              "Evaporation"
            ],
            "correct": 2
          },
          {
            "question": "Which fraction is used to fuel aircraft?",
            "options": [
              "Petrol",
              "Kerosene",
              "Diesel oil",
              "Bitumen"
            ],
            "correct": 1
          },
          {
            "question": "Which property increases as hydrocarbon chain length increases?",
            "options": [
              "Ease of ignition",
              "Boiling point",
              "Flammability",
              "Combustibility"
            ],
            "correct": 1
          },
          {
            "question": "What are the products of complete combustion of a hydrocarbon?",
            "options": [
              "Carbon monoxide and water",
              "Carbon and water",
              "Carbon dioxide and water",
              "Hydrogen and oxygen"
            ],
            "correct": 2
          },
          {
            "question": "What gas is formed during incomplete combustion and is toxic?",
            "options": [
              "Carbon dioxide",
              "Nitrogen",
              "Carbon monoxide",
              "Sulfur dioxide"
            ],
            "correct": 2
          },
          {
            "question": "What process breaks down large alkanes into smaller molecules?",
            "options": [
              "Distillation",
              "Evaporation",
              "Condensation",
              "Cracking"
            ],
            "correct": 3
          }
        ],
        "terms": [
          {
            "term": "Hydrocarbon",
            "definition": "A compound made up of hydrogen and carbon only."
          },
          {
            "term": "Fractional distillation",
            "definition": "A method to separate a mixture into its individual components based on boiling points."
          },
          {
            "term": "Complete combustion",
            "definition": "A reaction in which a fuel burns in excess oxygen to produce carbon dioxide and water."
          },
          {
            "term": "Incomplete combustion",
            "definition": "A reaction where there is not enough oxygen, producing carbon monoxide or carbon."
          },
          {
            "term": "Cracking",
            "definition": "The process of breaking large hydrocarbons into smaller, more useful ones."
          }
        ],
        "exam": []
      },
      "Earth and atmospheric science": {
        "quiz": [
          {
            "question": "What gas was NOT present in large amounts in the Earths early atmosphere?",
            "options": [
              "Carbon dioxide",
              "Oxygen",
              "Water vapour",
              "Other gases"
            ],
            "correct": 1
          },
          {
            "question": "How were the Earths oceans formed?",
            "options": [
              "By precipitation from meteors",
              "From condensation of water vapour",
              "By chemical reactions underground",
              "By solar radiation"
            ],
            "correct": 1
          },
          {
            "question": "What caused oxygen levels to increase in the early atmosphere?",
            "options": [
              "Volcanoes",
              "Combustion reactions",
              "Photosynthesis by primitive plants",
              "Evaporation of oceans"
            ],
            "correct": 2
          },
          {
            "question": "Which gases contribute to the greenhouse effect?",
            "options": [
              "Oxygen and nitrogen",
              "Hydrogen and helium",
              "Carbon dioxide, methane, and water vapour",
              "Ozone and argon"
            ],
            "correct": 2
          },
          {
            "question": "What is a possible consequence of increased levels of greenhouse gases?",
            "options": [
              "Ozone depletion",
              "Rising global temperatures",
              "Increased oxygen levels",
              "Decreased rainfall"
            ],
            "correct": 1
          },
          {
            "question": "What is the test for oxygen?",
            "options": [
              "A litmus test",
              "Relighting a glowing splint",
              "Turning limewater cloudy",
              "Popping a lighted splint"
            ],
            "correct": 1
          }
        ],
        "terms": [
          {
            "term": "Greenhouse effect",
            "definition": "The process by which greenhouse gases trap heat from the Earths surface, keeping the planet warm."
          },
          {
            "term": "Carbon monoxide",
            "definition": "A toxic gas formed by the incomplete combustion of carbon-containing fuels."
          },
          {
            "term": "Sulfur dioxide",
            "definition": "A gas produced by burning fuels containing sulfur; contributes to acid rain."
          },
          {
            "term": "Photosynthesis",
            "definition": "A process used by plants to convert carbon dioxide and water into glucose and oxygen using sunlight."
          },
          {
            "term": "Crude oil",
            "definition": "A finite mixture of hydrocarbons that can be separated by fractional distillation."
          }
        ],
        "exam": []
      },
      "Suggested practicals": {
        "quiz": [],
        "terms": [],
        "exam": []
      }
    }
  },
            "9. Separate Chemistry 2": {
    "subtopics": {
      "Qualitative analysis: tests for ions": {
        "quiz": [
          {
            "question": "Why must the test for any ion be unique?",
            "options": [
              "To save time in the lab",
              "So results can be compared with others",
              "To avoid confusion with other ions",
              "Because all ions look the same"
            ],
            "correct": 2
          },
          {
            "question": "What colour does lithium produce in a flame test?",
            "options": [
              "Yellow",
              "Lilac",
              "Red",
              "Blue-green"
            ],
            "correct": 2
          },
          {
            "question": "What precipitate is formed when Al reacts with sodium hydroxide?",
            "options": [
              "Green precipitate",
              "Blue precipitate",
              "White precipitate that redissolves in excess",
              "Brown precipitate"
            ],
            "correct": 2
          },
          {
            "question": "How is ammonia gas tested for?",
            "options": [
              "Using limewater",
              "With damp red litmus paper",
              "By a glowing splint",
              "By smell"
            ],
            "correct": 1
          },
          {
            "question": "What gas is produced when a carbonate reacts with acid?",
            "options": [
              "Hydrogen",
              "Oxygen",
              "Carbon dioxide",
              "Ammonia"
            ],
            "correct": 2
          },
          {
            "question": "Which reagent is used to test for sulfate ions?",
            "options": [
              "Dilute nitric acid",
              "Silver nitrate",
              "Barium chloride and hydrochloric acid",
              "Limewater"
            ],
            "correct": 2
          },
          {
            "question": "What colour precipitate forms with chloride ions and silver nitrate?",
            "options": [
              "White",
              "Cream",
              "Yellow",
              "Blue"
            ],
            "correct": 0
          }
        ],
        "terms": [],
        "exam": []
      },
      "Hydrocarbons": {
        "quiz": [
          {
            "question": "What is the general formula for alkanes?",
            "options": [
              "CnH2n",
              "CnH2n+2",
              "CnH2n-2",
              "CnH2nO2"
            ],
            "correct": 1
          },
          {
            "question": "What feature do all alkenes have?",
            "options": [
              "An OH group",
              "A double carbon bond (C=C)",
              "A carboxylic acid group",
              "A triple carbon bond"
            ],
            "correct": 1
          },
          {
            "question": "How does bromine water test for alkenes?",
            "options": [
              "It turns red",
              "It turns colourless",
              "It gives off a gas",
              "It forms a precipitate"
            ],
            "correct": 1
          },
          {
            "question": "What are the products of complete combustion of alkanes?",
            "options": [
              "Carbon monoxide and water",
              "Carbon dioxide and water",
              "Hydrogen and oxygen",
              "Soot and water"
            ],
            "correct": 1
          }
        ],
        "terms": [],
        "exam": []
      },
      "Polymers": {
        "quiz": [
          {
            "question": "What type of polymer is poly(ethene)?",
            "options": [
              "Condensation polymer",
              "Addition polymer",
              "Natural polymer",
              "Crosslinked polymer"
            ],
            "correct": 1
          },
          {
            "question": "What small molecules are eliminated in condensation polymerisation?",
            "options": [
              "Oxygen",
              "Carbon dioxide",
              "Water",
              "Ethanol"
            ],
            "correct": 2
          },
          {
            "question": "Which property is typical of PTFE?",
            "options": [
              "High flammability",
              "Low melting point",
              "Non-stick surface",
              "Strong acidity"
            ],
            "correct": 2
          },
          {
            "question": "What problem is associated with non-biodegradable polymers?",
            "options": [
              "They are too reactive",
              "They release oxygen",
              "They persist in landfill",
              "They dissolve in water"
            ],
            "correct": 2
          }
        ],
        "terms": [],
        "exam": []
      },
      "Alcohols and carboxylic acids": {
        "quiz": [
          {
            "question": "What is the functional group in alcohols?",
            "options": [
              "COOH",
              "OH",
              "C=C",
              "NH2"
            ],
            "correct": 1
          },
          {
            "question": "Which alcohol is commonly found in alcoholic drinks?",
            "options": [
              "Methanol",
              "Propanol",
              "Butanol",
              "Ethanol"
            ],
            "correct": 3
          },
          {
            "question": "How can ethanol be produced in the lab?",
            "options": [
              "By burning methane",
              "By reacting alkenes with water",
              "By fermentation of sugar using yeast",
              "By condensing steam"
            ],
            "correct": 2
          },
          {
            "question": "What is the functional group of carboxylic acids?",
            "options": [
              "OH",
              "COOH",
              "NH2",
              "C=C"
            ],
            "correct": 1
          }
        ],
        "terms": [],
        "exam": []
      },
      "Bulk and surface properties of matter including nanoparticles": {
        "quiz": [
          {
            "question": "What is a typical size range for nanoparticles?",
            "options": [
              "1100 nm",
              "1100 m",
              "110 mm",
              "110 pm"
            ],
            "correct": 0
          },
          {
            "question": "Why are nanoparticles useful in sunscreens?",
            "options": [
              "They reflect visible light",
              "They absorb UV radiation",
              "They dissolve in water",
              "They react with sweat"
            ],
            "correct": 1
          },
          {
            "question": "Which of the following is a potential risk of nanoparticles?",
            "options": [
              "High cost",
              "Environmental biodegradability",
              "Toxicity to human cells",
              "Low reactivity"
            ],
            "correct": 2
          },
          {
            "question": "Which has the highest surface area to volume ratio?",
            "options": [
              "Bulk materials",
              "Microparticles",
              "Nanoparticles",
              "Molecules"
            ],
            "correct": 2
          }
        ],
        "terms": [],
        "exam": []
      }
    }
  },
},
            physics: {
                "1. Forces and Motion": {
                    subtopics: {
                        "1.1 Newton's Laws": {
                            quiz: [
                                {
                                    question: "What is Newton's first law of motion?",
                                    options: ["F = ma", "Objects at rest stay at rest", "Action-reaction", "Conservation of momentum"],
                                    correct: 1
                                }
                            ],
                            terms: [
                                {
                                    term: "Inertia",
                                    definition: "The tendency of an object to resist changes in its state of motion"
                                }
                            ],
                            exam: []
                        },
                        "1.2 Forces": {
                            quiz: [
                                {
                                    question: "What is the SI unit of force?",
                                    options: ["Newton", "Joule", "Watt", "Pascal"],
                                    correct: 0
                                }
                            ],
                            terms: [
                                {
                                    term: "Force",
                                    definition: "A push or pull that can change the motion of an object"
                                }
                            ],
                            exam: []
                        }
                    },
                    quiz: [
                        {
                            question: "What is Newton's first law of motion?",
                            options: ["F = ma", "Objects at rest stay at rest", "Action-reaction", "Conservation of momentum"],
                            correct: 1
                        }
                    ],
                    terms: [
                        {
                            term: "Force",
                            definition: "A push or pull that can change the motion of an object"
                        }
                    ],
                    exam: []
                },
                "2. Energy": {
                    subtopics: {
                        "2.1 Energy Types": {
                            quiz: [
                                {
                                    question: "What is kinetic energy?",
                                    options: ["Stored energy", "Energy of motion", "Heat energy", "Light energy"],
                                    correct: 1
                                }
                            ],
                            terms: [
                                {
                                    term: "Kinetic Energy",
                                    definition: "The energy an object has due to its motion"
                                }
                            ],
                            exam: []
                        },
                        "2.2 Energy Conversion": {
                            quiz: [
                                {
                                    question: "When a ball falls, what energy conversion occurs?",
                                    options: ["Kinetic to potential", "Potential to kinetic", "Thermal to kinetic", "Chemical to kinetic"],
                                    correct: 1
                                }
                            ],
                            terms: [
                                {
                                    term: "Conservation of Energy",
                                    definition: "Energy cannot be created or destroyed, only transformed from one form to another"
                                }
                            ],
                            exam: []
                        }
                    },
                    quiz: [
                        {
                            question: "What is kinetic energy?",
                            options: ["Stored energy", "Energy of motion", "Heat energy", "Light energy"],
                            correct: 1
                        }
                    ],
                    terms: [
                        {
                            term: "Kinetic Energy",
                            definition: "The energy an object has due to its motion"
                        }
                    ],
                    exam: []
                }
            },
            biology: {
                "1. Cell Biology": {
                    subtopics: {
                        "1.1 Cell Structure": {
                            quiz: [
                                {
                                    question: "What is the powerhouse of the cell?",
                                    options: ["Nucleus", "Mitochondria", "Ribosome", "Chloroplast"],
                                    correct: 1
                                }
                            ],
                            terms: [
                                {
                                    term: "Mitochondria",
                                    definition: "The organelle responsible for producing ATP energy in cells"
                                }
                            ],
                            exam: []
                        },
                        "1.2 Cell Division": {
                            quiz: [
                                {
                                    question: "What is mitosis?",
                                    options: ["Sexual reproduction", "Cell division resulting in identical cells", "Cell division for gametes", "Protein synthesis"],
                                    correct: 1
                                }
                            ],
                            terms: [
                                {
                                    term: "Mitosis",
                                    definition: "Cell division resulting in two genetically identical daughter cells"
                                }
                            ],
                            exam: []
                        }
                    },
                    quiz: [
                        {
                            question: "What is the powerhouse of the cell?",
                            options: ["Nucleus", "Mitochondria", "Ribosome", "Chloroplast"],
                            correct: 1
                        }
                    ],
                    terms: [
                        {
                            term: "Mitochondria",
                            definition: "The organelle responsible for producing ATP energy in cells"
                        }
                    ],
                    exam: []
                },
                "2. Genetics": {
                    subtopics: {
                        "2.1 DNA Structure": {
                            quiz: [
                                {
                                    question: "What does DNA stand for?",
                                    options: ["Deoxyribonucleic Acid", "Dynamic Nuclear Acid", "Digital Nucleic Acid", "Double Nuclear Acid"],
                                    correct: 0
                                }
                            ],
                            terms: [
                                {
                                    term: "DNA",
                                    definition: "Deoxyribonucleic acid, the molecule that carries genetic information"
                                }
                            ],
                            exam: []
                        },
                        "2.2 Inheritance": {
                            quiz: [
                                {
                                    question: "What are alleles?",
                                    options: ["Types of cells", "Different forms of a gene", "Sex chromosomes", "Types of mutations"],
                                    correct: 1
                                }
                            ],
                            terms: [
                                {
                                    term: "Allele",
                                    definition: "One of two or more alternative forms of a gene at the same position on homologous chromosomes"
                                }
                            ],
                            exam: []
                        }
                    },
                    quiz: [
                        {
                            question: "What does DNA stand for?",
                            options: ["Deoxyribonucleic Acid", "Dynamic Nuclear Acid", "Digital Nucleic Acid", "Double Nuclear Acid"],
                            correct: 0
                        }
                    ],
                    terms: [
                        {
                            term: "DNA",
                            definition: "Deoxyribonucleic acid, the molecule that carries genetic information"
                        }
                    ],
                    exam: []
                }
            }
        };

        // Global variables
        let progressData = JSON.parse(localStorage.getItem('smartReviseProgress')) || {};
        let settings = JSON.parse(localStorage.getItem('smartReviseSettings')) || {
            darkMode: false,
            autoProgress: false,
            sounds: true,
            shuffle: true,
            immediateReading: true
        };
        let currentSubject = '';
        let selectedTopics = [];
        let currentMode = '';
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let correctAnswers = 0;
        let currentStreak = 0;
        let maxStreak = 0;
        let charts = {};

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializeProgress();
            initializeSettings();
            setupEventListeners();
            updateReportsDisplay();
            updateHomeAnalytics();
            
            // Direct event listener for settings tab to ensure it works
            document.getElementById('settings-tab').addEventListener('click', function(e) {
                e.preventDefault();
                console.log("Settings tab clicked directly");
                
                // Hide all other sections
                document.getElementById('home-section').classList.add('hidden');
                document.getElementById('reports-section').classList.add('hidden');
                document.getElementById('subject-selection').classList.add('hidden');
                document.getElementById('topic-selection').classList.add('hidden');
                document.getElementById('mode-selection-container').classList.add('hidden');
                document.getElementById('question-section').classList.add('hidden');
                document.getElementById('terms-section').classList.add('hidden');
                
                // Update active tab
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.getElementById('settings-tab').classList.add('active');
                
                // Show settings section
                document.getElementById('settings-section').classList.remove('hidden');
                
                return false;
            });
        });

        function setupEventListeners() {
            // Navigation tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    showSection(this.dataset.section);
                });
            });

            // Subject cards
            document.querySelectorAll('.subject-card').forEach(card => {
                card.addEventListener('click', function() {
                    selectSubject(this.dataset.subject);
                });
            });

            // Mode cards
            document.querySelectorAll('.mode-card').forEach(card => {
                card.addEventListener('click', function() {
                    startMode(this.dataset.mode);
                });
            });

            // Report items
            document.querySelectorAll('.report-item').forEach(item => {
                item.addEventListener('click', function() {
                    showReport(this.dataset.report);
                });
            });

            // Buttons
            document.getElementById('select-all-btn').addEventListener('click', selectAllTopics);
            document.getElementById('clear-all-btn').addEventListener('click', clearTopics);
            document.getElementById('study-btn').addEventListener('click', showModeSelection);
            document.getElementById('prev-btn').addEventListener('click', previousQuestion);
            document.getElementById('next-btn').addEventListener('click', nextQuestion);
            document.getElementById('show-def-btn').addEventListener('click', () => {
    showDefinition();
    document.getElementById("rating-buttons").classList.remove("hidden");
});
            document.getElementById('prev-term-btn').addEventListener('click', previousTerm);
            document.getElementById('next-term-btn').addEventListener('click', nextTerm);

            // Rating buttons
            document.querySelectorAll('.rating-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    rateAnswer(this.dataset.rating);
                });
            });

            // Settings toggles
            document.getElementById('theme-toggle').addEventListener('click', function() {
                toggleTheme();
                console.log("Theme toggled");
            });
            document.getElementById('auto-progress-toggle').addEventListener('click', () => {
                toggleSetting('autoProgress');
                console.log("Auto progress toggled");
            });
            document.getElementById('sound-toggle').addEventListener('click', () => {
                toggleSetting('sounds');
                console.log("Sound toggled");
            });
            document.getElementById('shuffle-toggle').addEventListener('click', () => {
                toggleSetting('shuffle');
                console.log("Shuffle toggled");
            });
            document.getElementById('feedback-toggle').addEventListener('click', () => {
                toggleSetting('immediateReading');
                console.log("Feedback toggled");
            });

            // Data management
            document.getElementById('export-btn').addEventListener('click', exportData);
            document.getElementById('import-btn').addEventListener('click', () => document.getElementById('import-file').click());
            document.getElementById('import-file').addEventListener('change', importData);
            document.getElementById('reset-progress-btn').addEventListener('click', resetProgress);
            document.getElementById('clear-data-btn').addEventListener('click', clearAllData);
        }

        // Notification System
        function showNotification(title, message, type = 'info', duration = 4000) {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const iconMap = {
                success: 'fa-check-circle',
                error: 'fa-times-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="fas ${iconMap[type]}"></i>
                </div>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <div class="notification-close">
                    <i class="fas fa-times"></i>
                </div>
            `;
            
            // Close functionality
            notification.querySelector('.notification-close').addEventListener('click', () => {
                removeNotification(notification);
            });
            
            notification.addEventListener('click', () => {
                removeNotification(notification);
            });
            
            container.appendChild(notification);
            
            // Auto remove
            setTimeout(() => {
                if (notification.parentNode) {
                    removeNotification(notification);
                }
            }, duration);
        }

        function removeNotification(notification) {
            notification.classList.add('fade-out');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }

        function initializeProgress() {
            for (let subject in questionData) {
                if (!progressData[subject]) {
                    progressData[subject] = {};
                }
                for (let topic in questionData[subject]) {
                    if (!progressData[subject][topic]) {
                        progressData[subject][topic] = {
                            quiz: { correct: 0, total: 0, streak: 0, mastered: false, lastAttempt: null },
                            terms: { ratings: {}, total: 0, mastered: false, lastAttempt: null },
                            exam: { correct: 0, total: 0, streak: 0, mastered: false, lastAttempt: null }
                        };
                    }
                }
            }
            saveProgress();
        }

        function initializeSettings() {
            // Apply theme
            document.documentElement.setAttribute('data-theme', settings.darkMode ? 'dark' : 'light');
            
            // Update toggle states
            document.getElementById('theme-toggle').classList.toggle('active', settings.darkMode);
            document.getElementById('auto-progress-toggle').classList.toggle('active', settings.autoProgress);
            document.getElementById('sound-toggle').classList.toggle('active', settings.sounds);
            document.getElementById('shuffle-toggle').classList.toggle('active', settings.shuffle);
            document.getElementById('feedback-toggle').classList.toggle('active', settings.immediateReading);
        }

        function saveProgress() {
            localStorage.setItem('smartReviseProgress', JSON.stringify(progressData));
        }

        function saveSettings() {
            localStorage.setItem('smartReviseSettings', JSON.stringify(settings));
        }

        function showSection(section) {
            // First hide all study-related sections
            document.getElementById('subject-selection').classList.add('hidden');
            document.getElementById('topic-selection').classList.add('hidden');
            document.getElementById('mode-selection-container').classList.add('hidden');
            document.getElementById('question-section').classList.add('hidden');
            document.getElementById('terms-section').classList.add('hidden');
            
            // Update nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-section="${section}"]`).classList.add('active');

            // Hide all sections
            document.querySelectorAll('#home-section, #reports-section, #settings-section').forEach(sec => {
                sec.classList.add('hidden');
            });

            // Show selected section
            document.getElementById(section + '-section').classList.remove('hidden');

            // If showing home, make sure subject selection is visible
            if (section === 'home') {
                document.getElementById('subject-selection').classList.remove('hidden');
            }
            
            // If showing reports, update the display
            if (section === 'reports') {
                updateReportsDisplay();
            }
            
            // Force redraw to ensure everything is displayed properly
            window.dispatchEvent(new Event('resize'));
        }
        
        // Dedicated function for showing settings to ensure it always works
        function showSettingsSection() {
            // Hide home section
            document.getElementById('home-section').classList.add('hidden');
            document.getElementById('reports-section').classList.add('hidden');
            
            // Hide all study-related sections for safety
            document.getElementById('subject-selection').classList.add('hidden');
            document.getElementById('topic-selection').classList.add('hidden');
            document.getElementById('mode-selection-container').classList.add('hidden');
            document.getElementById('question-section').classList.add('hidden');
            document.getElementById('terms-section').classList.add('hidden');
            
            // Update active tab
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById('settings-tab').classList.add('active');
            
            // Show settings section
            document.getElementById('settings-section').classList.remove('hidden');
            
            // Ensure all toggles reflect current settings
            document.getElementById('theme-toggle').classList.toggle('active', settings.darkMode);
            document.getElementById('auto-progress-toggle').classList.toggle('active', settings.autoProgress);
            document.getElementById('sound-toggle').classList.toggle('active', settings.sounds);
            document.getElementById('shuffle-toggle').classList.toggle('active', settings.shuffle);
            document.getElementById('feedback-toggle').classList.toggle('active', settings.immediateReading);
            
            console.log("Settings section shown");
        }

        function selectSubject(subject) {
            currentSubject = subject;
            
            // Update UI
            document.querySelectorAll('.subject-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`[data-subject="${subject}"]`).classList.add('selected');
            
            // Show topic selection
            document.getElementById('topic-selection').classList.remove('hidden');
            document.getElementById('mode-selection-container').classList.add('hidden');
            populateTopics();
            
            // Removed notification
        }

        function populateTopics() {
            const topicGrid = document.getElementById('topic-grid');
            topicGrid.innerHTML = '';
            selectedTopics = [];
            
            if (questionData[currentSubject]) {
                for (let topic in questionData[currentSubject]) {
                    const topicContainer = document.createElement('div');
                    topicContainer.className = 'topic-container';
                    topicContainer.style.marginBottom = '16px';
                    
                    const topicHeader = document.createElement('div');
                    topicHeader.className = 'topic-item main-topic';
                    topicHeader.textContent = topic;
                    topicHeader.style.fontWeight = 'bold';
                    topicHeader.style.backgroundColor = 'var(--bg-tertiary)';
                    topicHeader.addEventListener('click', function() {
                        toggleTopic(topic, this);
                    });
                    topicContainer.appendChild(topicHeader);
                    
                    // Add subtopics if they exist
                    if (questionData[currentSubject][topic].subtopics) {
                        const subtopicsContainer = document.createElement('div');
                        subtopicsContainer.style.display = 'grid';
                        subtopicsContainer.style.gridTemplateColumns = 'repeat(auto-fill, minmax(180px, 1fr))';
                        subtopicsContainer.style.gap = '8px';
                        subtopicsContainer.style.marginTop = '8px';
                        subtopicsContainer.style.marginLeft = '16px';
                        
                        for (let subtopic in questionData[currentSubject][topic].subtopics) {
                            const subtopicItem = document.createElement('div');
                            subtopicItem.className = 'topic-item subtopic-item';
                            subtopicItem.textContent = subtopic;
                            subtopicItem.style.fontSize = '13px';
                            subtopicItem.addEventListener('click', function(e) {
                                e.stopPropagation();
                                toggleSubtopic(topic, subtopic, this);
                            });
                            subtopicsContainer.appendChild(subtopicItem);
                        }
                        
                        topicContainer.appendChild(subtopicsContainer);
                    }
                    
                    topicGrid.appendChild(topicContainer);
                }
            }
        }

        function toggleTopic(topic, element) {
            // Check if topic is already selected
            if (selectedTopics.some(t => t.mainTopic === topic && !t.subtopic)) {
                // Remove main topic and all its subtopics
                selectedTopics = selectedTopics.filter(t => t.mainTopic !== topic);
                element.classList.remove('selected');
                
                // Deselect all subtopic elements
                const subtopicElements = element.parentNode.querySelectorAll('.subtopic-item');
                subtopicElements.forEach(el => el.classList.remove('selected'));
            } else {
                // Add main topic
                selectedTopics.push({ mainTopic: topic, subtopic: null });
                element.classList.add('selected');
                
                // Select all subtopic elements
                const subtopicElements = element.parentNode.querySelectorAll('.subtopic-item');
                subtopicElements.forEach(el => {
                    el.classList.add('selected');
                    // Get subtopic name from element text
                    const subtopicName = el.textContent;
                    // Add subtopic if not already added
                    if (!selectedTopics.some(t => t.mainTopic === topic && t.subtopic === subtopicName)) {
                        selectedTopics.push({ mainTopic: topic, subtopic: subtopicName });
                    }
                });
            }
        }
        
        function toggleSubtopic(mainTopic, subtopic, element) {
            const topicObj = { mainTopic, subtopic };
            const isSelected = element.classList.contains('selected');
            
            if (isSelected) {
                // Remove this specific subtopic
                selectedTopics = selectedTopics.filter(
                    t => !(t.mainTopic === mainTopic && t.subtopic === subtopic)
                );
                element.classList.remove('selected');
                
                // Also unselect the main topic if it was selected
                const mainTopicElement = element.closest('.topic-container').querySelector('.main-topic');
                if (mainTopicElement.classList.contains('selected')) {
                    mainTopicElement.classList.remove('selected');
                    selectedTopics = selectedTopics.filter(
                        t => !(t.mainTopic === mainTopic && t.subtopic === null)
                    );
                }
            } else {
                // Add this specific subtopic
                selectedTopics.push(topicObj);
                element.classList.add('selected');
                
                // Check if all subtopics are now selected
                const subtopicElements = element.closest('.topic-container').querySelectorAll('.subtopic-item');
                const allSubtopicsSelected = Array.from(subtopicElements).every(el => el.classList.contains('selected'));
                
                // If all subtopics are selected, also select the main topic
                if (allSubtopicsSelected) {
                    const mainTopicElement = element.closest('.topic-container').querySelector('.main-topic');
                    mainTopicElement.classList.add('selected');
                    if (!selectedTopics.some(t => t.mainTopic === mainTopic && t.subtopic === null)) {
                        selectedTopics.push({ mainTopic, subtopic: null });
                    }
                }
            }
        }

        function selectAllTopics() {
            selectedTopics = Object.keys(questionData[currentSubject] || {});
            document.querySelectorAll('.topic-item').forEach(item => {
                item.classList.add('selected');
            });
            showNotification('Topics Selected', `Selected all ${selectedTopics.length} topics`, 'success');
        }

        function clearTopics() {
            selectedTopics = [];
            document.querySelectorAll('.topic-item').forEach(item => {
                item.classList.remove('selected');
            });
            showNotification('Topics Cleared', 'All topic selections cleared', 'info');
        }

        function showModeSelection() {
            if (selectedTopics.length === 0) {
                showNotification('No Topics Selected', 'Please select at least one topic to study', 'error');
                return;
            }
            document.getElementById('mode-selection-container').classList.remove('hidden');
        }

        function startMode(mode) {
            if (!currentSubject || selectedTopics.length === 0) {
                showNotification('Missing Selection', 'Please select a subject and at least one topic', 'error');
                return;
            }
            
            currentMode = mode;
            currentQuestions = [];
            currentQuestionIndex = 0;
            userAnswers = [];
            correctAnswers = 0;
            currentStreak = 0;
            
            // Collect questions from selected topics and subtopics
            selectedTopics.forEach(topicObj => {
                const { mainTopic, subtopic } = topicObj;
                
                // If it's a subtopic
                if (subtopic) {
                    const subtopicData = questionData[currentSubject][mainTopic].subtopics[subtopic];
                    if (subtopicData && subtopicData[mode] && subtopicData[mode].length > 0) {
                        currentQuestions.push(...subtopicData[mode].map(q => ({
                            ...q, 
                            topic: mainTopic,
                            subtopic: subtopic
                        })));
                    }
                } 
                // If it's a main topic (and not a subtopic selection)
                else if (!selectedTopics.some(t => t.mainTopic === mainTopic && t.subtopic)) {
                    // Only add main topic questions if no subtopics of this topic were specifically selected
                    const topicData = questionData[currentSubject][mainTopic];
                    if (topicData[mode] && topicData[mode].length > 0) {
                        currentQuestions.push(...topicData[mode].map(q => ({
                            ...q, 
                            topic: mainTopic,
                            subtopic: null
                        })));
                    }
                }
            });
            
            if (currentQuestions.length === 0) {
                showNotification('No Questions Available', `No ${mode} questions found for selected topics`, 'warning');
                return;
            }
            
            // Shuffle questions if enabled
            if (settings.shuffle) {
                currentQuestions.sort(() => Math.random() - 0.5);
            }
            
            // Hide selection UI and show study UI
            document.getElementById('subject-selection').classList.add('hidden');
            document.getElementById('topic-selection').classList.add('hidden');
            document.getElementById('mode-selection-container').classList.add('hidden');
            
            // Remove notification to keep it cleaner
            
            if (mode === 'terms') {
                startTermsMode();
            } else {
                startQuizMode();
            }
        }

        function startQuizMode() {
            document.getElementById('question-section').classList.remove('hidden');
            document.getElementById('terms-section').classList.add('hidden');
            document.getElementById('total-questions').textContent = currentQuestions.length;
            userAnswers = new Array(currentQuestions.length).fill(null);
            showQuestion();
        }

        function startTermsMode() {
            document.getElementById('question-section').classList.add('hidden');
            document.getElementById('terms-section').classList.remove('hidden');
            showTerm();
        }

        function showQuestion() {
            if (currentQuestionIndex >= currentQuestions.length) {
                currentQuestionIndex = 0;
                showQuestion(); // Loop instead of stopping
                return;
            }
            
            const question = currentQuestions[currentQuestionIndex];
            document.getElementById('question-text').textContent = question.question;
            document.getElementById('correct-count').textContent = correctAnswers;
            document.getElementById('streak-count').textContent = currentStreak;
            
            // Update progress bar based on streak for this question
            const questionStreak = getQuestionStreak(question);
            updateProgressBar(questionStreak);
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            // Create option elements
            if (question.options && Array.isArray(question.options)) {
                question.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    optionDiv.textContent = option;
                    optionDiv.dataset.index = index;
                    optionDiv.addEventListener('click', function() {
                        selectOption(index, this);
                    });
                    
                    optionsContainer.appendChild(optionDiv);
                });
            } else {
                // Fallback if options array is missing
                console.error('Question options missing or invalid:', question);
                optionsContainer.innerHTML = '<div class="feedback incorrect"><i class="fas fa-exclamation-triangle"></i> Error: Question options not found</div>';
            }
            
            // Clear feedback
            document.getElementById('feedback-container').innerHTML = '';
            
            // Update progress text (empty for looping questions)
            document.getElementById('progress-text').textContent = '';
                
            // Update navigation buttons
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            document.getElementById('next-btn').disabled = false;
            
            // Clear userAnswers for this question to prevent auto-selection next time
            userAnswers[currentQuestionIndex] = null;
        }
        
        function getQuestionStreak(question) {
            // Get the streak for a specific question from progress data
            if (!progressData[currentSubject] || 
                !progressData[currentSubject][question.topic] || 
                !progressData[currentSubject][question.topic].questionStreaks) {
                return 0;
            }
            
            // Assuming we have a way to identify questions uniquely, like by their text
            return progressData[currentSubject][question.topic].questionStreaks[question.question] || 0;
        }
        
        function updateProgressBar(streak) {
            const progressBar = document.getElementById('question-progress-bar');
            
            // Set color and width based on streak
            if (streak >= 3) {
                progressBar.style.backgroundColor = 'var(--success-color)';
                progressBar.style.width = '100%';
            } else if (streak === 2) {
                progressBar.style.backgroundColor = 'var(--warning-color)';
                progressBar.style.width = '66%';
            } else if (streak === 1) {
                progressBar.style.backgroundColor = '#f0ad4e'; // yellow
                progressBar.style.width = '33%';
            } else {
                progressBar.style.backgroundColor = 'var(--error-color)';
                progressBar.style.width = '0%';
            }
        }

        function selectOption(optionIndex, optionElement) {
            try {
                // Clear previous selections
                document.querySelectorAll('.option').forEach(opt => {
                    opt.classList.remove('selected');
                    opt.classList.remove('correct');
                    opt.classList.remove('incorrect');
                });
                
                // Select current option
                optionElement.classList.add('selected');
                
                // Only count as new answer if different from previous
                const wasNewAnswer = userAnswers[currentQuestionIndex] !== optionIndex;
                userAnswers[currentQuestionIndex] = optionIndex;
                
                // Show immediate feedback if enabled
                if (settings.immediateReading) {
                    showFeedback(optionIndex, wasNewAnswer);
                }
                
                // Auto progress if enabled
                if (settings.autoProgress) {
                    setTimeout(() => {
                        nextQuestion();
                    }, 1500);
                }
            } catch (error) {
                console.error('Error in selectOption:', error);
                showNotification('Error', 'An error occurred when selecting an option', 'error');
            }
        }

        function showFeedback(selectedIndex, isNewAnswer) {
            try {
                const question = currentQuestions[currentQuestionIndex];
                const feedbackContainer = document.getElementById('feedback-container');
                
                // If there are no options or correct index is invalid, show error
                if (!question.options || !Array.isArray(question.options) || 
                    typeof question.correct !== 'number' || 
                    question.correct < 0 || 
                    question.correct >= question.options.length) {
                    
                    feedbackContainer.innerHTML = '<div class="feedback incorrect"><i class="fas fa-exclamation-triangle"></i> Error: Invalid question format</div>';
                    return;
                }
                
                const isCorrect = selectedIndex === question.correct;
                let feedbackHTML = '';
                
                // Update streak and progress only on new answers
                if (isNewAnswer) {
                    if (isCorrect) {
                        correctAnswers++;
                        currentStreak++;
                        maxStreak = Math.max(maxStreak, currentStreak);
                        
                        // Update streak display immediately
                        document.getElementById('streak-count').textContent = currentStreak;
                        document.getElementById('correct-count').textContent = correctAnswers;
                        
                        // Update progress data
                        updateProgress(question, true);
                    } else {
                        currentStreak = 0;
                        document.getElementById('streak-count').textContent = currentStreak;
                        
                        // Update progress data
                        updateProgress(question, false);
                    }
                }
                
                // Show visual feedback
                const options = document.querySelectorAll('.option');
                options[question.correct].classList.add('correct');
                
                if (!isCorrect) {
                    options[selectedIndex].classList.add('incorrect');
                }
                
                // Show text feedback
                if (isCorrect) {
                    feedbackHTML = '<div class="feedback correct"><i class="fas fa-check-circle"></i>Correct! Good job!</div>';
                    if (question.explanation) {
                        feedbackHTML += `<div class="feedback correct"><i class="fas fa-info-circle"></i>${question.explanation}</div>`;
                    }
                } else {
                    feedbackHTML = `<div class="feedback incorrect"><i class="fas fa-times-circle"></i>Incorrect. The correct answer is: ${question.options[question.correct]}</div>`;
                    if (question.explanation) {
                        feedbackHTML += `<div class="feedback incorrect"><i class="fas fa-info-circle"></i>${question.explanation}</div>`;
                    }
                }
                
                feedbackContainer.innerHTML = feedbackHTML;
            } catch (error) {
                console.error('Error in showFeedback:', error);
                document.getElementById('feedback-container').innerHTML = 
                    '<div class="feedback incorrect"><i class="fas fa-exclamation-triangle"></i> Error showing feedback</div>';
            }
        }

        function updateHomeAnalytics() {
            let totalQuestions = 0;
            let totalCorrect = 0;
            let masteredTopics = 0;
            
            // Reset mastery progress container
            const masteryContainer = document.getElementById('home-mastery-progress');
            masteryContainer.innerHTML = '';
            
            let hasProgress = false;
            
            // Go through all subjects and topics
            for (let subject in progressData) {
                for (let topic in progressData[subject]) {
                    const topicData = progressData[subject][topic];
                    
                    // Count mastered topics
                    if (topicData.quiz.mastered || topicData.terms.mastered || topicData.exam.mastered) {
                        masteredTopics++;
                    }
                    
                    // Count questions
                    totalQuestions += topicData.quiz.total + topicData.exam.total + Object.keys(topicData.terms.ratings || {}).length;
                    totalCorrect += topicData.quiz.correct + topicData.exam.correct;
                    
                    // Count good term ratings as correct
                    const ratings = Object.values(topicData.terms.ratings || {});
                    totalCorrect += ratings.filter(r => r === 'easy' || r === 'medium').length;
                    
                    // Add to mastery progress display for any topic with activity
                    if (topicData.quiz.total > 0 || topicData.exam.total > 0 || Object.keys(topicData.terms.ratings || {}).length > 0) {
                        hasProgress = true;
                        let percentage = 0;
                        let totalAnswered = 0;
                        let totalAvailable = 0;
                        
                        // Calculate overall percentage across modes
                        if (topicData.quiz.total > 0) {
                            percentage += (topicData.quiz.correct / topicData.quiz.total) * (topicData.quiz.total);
                            totalAnswered += topicData.quiz.total;
                        }
                        
                        if (topicData.exam.total > 0) {
                            percentage += (topicData.exam.correct / topicData.exam.total) * (topicData.exam.total);
                            totalAnswered += topicData.exam.total;
                        }
                        
                        const termRatings = Object.values(topicData.terms.ratings || {});
                        if (termRatings.length > 0) {
                            const goodRatings = termRatings.filter(r => r === 'easy' || r === 'medium').length;
                            percentage += (goodRatings / termRatings.length) * termRatings.length;
                            totalAnswered += termRatings.length;
                        }
                        
                        // Calculate final percentage
                        percentage = totalAnswered > 0 ? Math.round((percentage / totalAnswered) * 100) : 0;
                        
                        // Create mastery card
                        const card = document.createElement('div');
                        card.className = 'mastery-card';
                        card.style.background = 'var(--bg-secondary)';
                        card.style.borderRadius = '8px';
                        card.style.padding = '16px';
                        
                        // Set color based on mastery
                        let statusColor = percentage >= 80 ? 'var(--success-color)' : 
                                        percentage >= 60 ? 'var(--warning-color)' : 
                                        'var(--error-color)';
                                        
                        // Mastery badge
                        const masteryBadge = (topicData.quiz.mastered || topicData.terms.mastered || topicData.exam.mastered) ? 
                            '<span style="background: var(--success-color); color: white; font-size: 11px; padding: 2px 6px; border-radius: 12px; margin-left: 8px;">Mastered</span>' : '';
                        
                        card.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <div style="font-weight: 600; color: var(--text-primary);">${subject} - ${topic}</div>
                                <div style="color: ${statusColor}; font-weight: 600;">${percentage}%${masteryBadge}</div>
                            </div>
                            <div style="height: 6px; background: var(--bg-tertiary); border-radius: 3px; overflow: hidden; margin-bottom: 8px;">
                                <div style="height: 100%; width: ${percentage}%; background: ${statusColor};"></div>
                            </div>
                            <div style="font-size: 12px; color: var(--text-secondary);">
                                ${totalAnswered} questions answered
                            </div>
                        `;
                        
                        masteryContainer.appendChild(card);
                    }
                }
            }
            
            // If no progress data, show message
            if (!hasProgress) {
                masteryContainer.innerHTML = `
                    <div style="text-align: center; color: var(--text-secondary); padding: 20px; grid-column: 1/-1;">
                        Start studying to see your progress here!
                    </div>
                `;
            }
            
            // Update summary stats
            const avgScore = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
            document.getElementById('home-avg-score').textContent = avgScore + '%';
            document.getElementById('home-total-questions').textContent = totalQuestions;
            document.getElementById('home-topics-mastered').textContent = masteredTopics;
            
            // Simulate a study streak for demo purposes (this would normally be based on daily usage)
            const streak = 3; // Placeholder value
            document.getElementById('home-study-streak').textContent = streak;
        }

        function nextQuestion() {
            if (currentQuestionIndex < currentQuestions.length - 1) {
                currentQuestionIndex++;
                
                if (currentMode === 'exam') {
                    showExamQuestion();
                } else {
                    showQuestion();
                }
            } else {
                // Loop back to start instead of showing results
                currentQuestionIndex = 0;
                if (currentMode === 'exam') {
                    showExamQuestion();
                } else {
                    showQuestion();
                }
            }
        }
        
        function showExamQuestion() {
            try {
                const question = currentQuestions[currentQuestionIndex];
                if (!question) {
                    console.error('Invalid exam question data:', question);
                    return;
                }
                
                document.getElementById('question-text').textContent = question.question;
                document.getElementById('correct-count').textContent = correctAnswers;
                document.getElementById('streak-count').textContent = currentStreak;

                // Get marking points from the question or use default ones
                const markingPoints = question.markingPoints || [
                    "Basic concept understanding (1 mark)",
                    "Correct terminology (1 mark)",
                    "Detailed explanation (2 marks)",
                    "Appropriate examples (1 mark)"
                ];
                
                // Create marking scheme HTML
                let markingPointsHTML = '';
                markingPoints.forEach((point, index) => {
                    markingPointsHTML += `
                        <div class="marking-point">
                            <input type="checkbox" id="mark-point-${index+1}" class="mark-checkbox">
                            <label for="mark-point-${index+1}">Point ${index+1}: ${point}</label>
                        </div>
                    `;
                });

                const optionsContainer = document.getElementById('options-container');
                optionsContainer.innerHTML = `
                    <textarea id="typed-answer" placeholder="Type your answer here..." style="width: 100%; min-height: 120px; border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; font-size: 16px; margin-bottom: 20px;"></textarea>
                    <div class="marking-scheme" style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 12px;">Marking Scheme:</h4>
                        <div class="marking-points" id="marking-points">
                            ${markingPointsHTML}
                        </div>
                    </div>
                    <div style="margin-top: 12px;">
                        <button class="btn btn-primary" id="submit-marks-btn">Submit Marks</button>
                    </div>
                `;
                
                // Add event listener to the submit marks button
                setTimeout(() => {
                    const submitBtn = document.getElementById('submit-marks-btn');
                    if (submitBtn) {
                        // Remove any existing listeners
                        const newBtn = submitBtn.cloneNode(true);
                        submitBtn.parentNode.replaceChild(newBtn, submitBtn);
                        newBtn.addEventListener('click', calculateMarks);
                    }
                }, 10);
                
                document.getElementById('feedback-container').innerHTML = "";
            } catch (error) {
                console.error('Error in showExamQuestion:', error);
                showNotification('Error', 'An error occurred when showing the exam question', 'error');
            }
        }

        function calculateMarks() {
            try {
                const checkboxes = document.querySelectorAll('.mark-checkbox:checked');
                let totalMarks = 0;
                
                checkboxes.forEach(checkbox => {
                    // Get the mark value from the ID or a data attribute
                    // This simple implementation assumes 1 mark per point, but you could extend it
                    if (checkbox.id === 'mark-point-3') {
                        totalMarks += 2; // This point is worth 2 marks as per the label
                    } else {
                        totalMarks += 1;
                    }
                });
                
                // Update progress and stats
                const question = currentQuestions[currentQuestionIndex];
                const feedbackContainer = document.getElementById('feedback-container');
                
                feedbackContainer.innerHTML = `
                    <div class="feedback correct">
                        <i class="fas fa-check-circle"></i>
                        You've awarded ${totalMarks} mark${totalMarks !== 1 ? 's' : ''} for this answer.
                    </div>
                `;
                
                // Update statistics
                correctAnswers += totalMarks;
                document.getElementById('correct-count').textContent = correctAnswers;
                
                // Update progress
                updateProgress(question, totalMarks > 0);
                
                // Enable next button or auto-progress
                if (settings.autoProgress) {
                    setTimeout(() => {
                        nextQuestion();
                    }, 1500);
                }
            } catch (error) {
                console.error('Error in calculateMarks:', error);
                showNotification('Error', 'An error occurred when calculating marks', 'error');
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        function showResults() {
            const percentage = Math.round((correctAnswers / currentQuestions.length) * 100);
            const modeName = currentMode === 'quiz' ? 'Smart Quiz' : currentMode === 'terms' ? 'Smart Terms' : 'Smart Advance';
            
            let message = `${modeName} Complete!\n\nScore: ${correctAnswers}/${currentQuestions.length} (${percentage}%)\nMax Streak: ${maxStreak}`;
            let notificationType = 'success';
            
            if (percentage >= 80) {
                message += '\n\nExcellent work! ';
            } else if (percentage >= 60) {
                message += '\n\nGood job! Keep practicing! ';
                notificationType = 'info';
            } else {
                message += '\n\nKeep studying to improve! ';
                notificationType = 'warning';
            }
            
            showNotification('Study Complete', message, notificationType, 6000);
            
            // Reset to home
            setTimeout(() => {
                resetToHome();
            }, 2000);
        }

        function resetToHome() {
            // First go to the home section
            showSection('home');
            
            document.getElementById('subject-selection').classList.remove('hidden');
            document.getElementById('topic-selection').classList.add('hidden');
            document.getElementById('mode-selection-container').classList.add('hidden');
            document.getElementById('question-section').classList.add('hidden');
            document.getElementById('terms-section').classList.add('hidden');
            
            // Clear selections
            document.querySelectorAll('.subject-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            currentSubject = '';
            selectedTopics = [];
            
            // Update analytics when returning home
            updateHomeAnalytics();
        }

        // Terms Mode Functions
        function showTerm() {
            try {
                if (currentQuestionIndex >= currentQuestions.length) {
                    showNotification('Terms Complete', 'All terms completed! Great job studying!', 'success');
                    setTimeout(() => {
                        resetToHome();
                    }, 2000);
                    return;
                }
                
                const term = currentQuestions[currentQuestionIndex];
                if (!term || !term.term) {
                    console.error('Invalid term data:', term);
                    document.getElementById('term-text').textContent = 'Error: Term data not found';
                    return;
                }
                
                document.getElementById('term-text').textContent = term.term;
                document.getElementById('definition-input').value = '';
                document.getElementById('term-feedback').innerHTML = '';
                document.getElementById('rating-buttons').classList.add('hidden');
                document.getElementById('term-progress').textContent = 
                    `${currentQuestionIndex + 1} of ${currentQuestions.length}`;
                
                // Update term progress bar
                updateTermProgressBar(term);
            } catch (error) {
                console.error('Error in showTerm:', error);
                showNotification('Error', 'An error occurred when showing the term', 'error');
            }
        }
        
        function updateTermProgressBar(term) {
            const progressBar = document.getElementById('term-progress-bar');
            
            // Check for existing rating in progress data
            let rating = 'unseen';
            if (progressData[currentSubject] && 
                progressData[currentSubject][term.topic] && 
                progressData[currentSubject][term.topic].terms && 
                progressData[currentSubject][term.topic].terms.ratings) {
                
                rating = progressData[currentSubject][term.topic].terms.ratings[term.term] || 'unseen';
            }
            
            // Set color and width based on rating
            if (rating === 'easy') {
                progressBar.style.backgroundColor = 'var(--success-color)';
                progressBar.style.width = '100%';
            } else if (rating === 'medium') {
                progressBar.style.backgroundColor = 'var(--warning-color)';
                progressBar.style.width = '66%';
            } else if (rating === 'hard') {
                progressBar.style.backgroundColor = '#f0ad4e'; // yellow
                progressBar.style.width = '33%';
            } else {
                progressBar.style.backgroundColor = 'var(--error-color)';
                progressBar.style.width = '0%';
            }
        }

        function showDefinition() {
            try {
                const term = currentQuestions[currentQuestionIndex];
                if (!term || !term.definition) {
                    console.error('Invalid term data or missing definition:', term);
                    document.getElementById('term-feedback').innerHTML = 
                        '<div class="feedback incorrect"><i class="fas fa-exclamation-triangle"></i>Error: Definition not found</div>';
                    return;
                }
                
                const correctDefinition = term.definition;
                const feedbackHTML = `<div class="feedback correct"><i class="fas fa-lightbulb"></i><strong>Correct Definition:</strong> ${correctDefinition}</div>`;
                document.getElementById('term-feedback').innerHTML = feedbackHTML;
                document.getElementById("rating-buttons").classList.remove("hidden");
            } catch (error) {
                console.error('Error in showDefinition:', error);
                document.getElementById('term-feedback').innerHTML = 
                    '<div class="feedback incorrect"><i class="fas fa-exclamation-triangle"></i>Error showing definition</div>';
            }
        }

        function rateAnswer(rating) {
            try {
                const term = currentQuestions[currentQuestionIndex];
                
                // Initialize or update progress for this subject and topic
                if (!progressData[currentSubject]) {
                    progressData[currentSubject] = {};
                }
                if (!progressData[currentSubject][term.topic]) {
                    progressData[currentSubject][term.topic] = {
                        quiz: { correct: 0, total: 0, streak: 0, mastered: false, lastAttempt: null, questionStreaks: {} },
                        terms: { ratings: {}, total: 0, mastered: false, lastAttempt: null },
                        exam: { correct: 0, total: 0, streak: 0, mastered: false, lastAttempt: null }
                    };
                }
                if (!progressData[currentSubject][term.topic].terms.ratings) {
                    progressData[currentSubject][term.topic].terms.ratings = {};
                }
                
                // Store the rating
                progressData[currentSubject][term.topic].terms.ratings[term.term] = rating;
                progressData[currentSubject][term.topic].terms.total = 
                    Object.keys(progressData[currentSubject][term.topic].terms.ratings).length;
                progressData[currentSubject][term.topic].terms.lastAttempt = Date.now();
                
                // Check for mastery (all terms rated as 'easy')
                const ratings = Object.values(progressData[currentSubject][term.topic].terms.ratings);
                const easyCount = ratings.filter(r => r === 'easy').length;
                progressData[currentSubject][term.topic].terms.mastered = (easyCount === ratings.length && ratings.length > 0);
                
                // Update the progress bar
                updateTermProgressBar(term);
                
                // Save and update analytics
                saveProgress();
                updateHomeAnalytics();
                
                // Show feedback based on rating
                let feedbackHTML = '';
                if (rating === 'easy') {
                    feedbackHTML = '<div class="feedback correct"><i class="fas fa-check-circle"></i>Great! You know this term well.</div>';
                } else if (rating === 'medium') {
                    feedbackHTML = '<div class="feedback correct"><i class="fas fa-info-circle"></i>Good! Keep reviewing to master it.</div>';
                } else {
                    feedbackHTML = '<div class="feedback incorrect"><i class="fas fa-book"></i>Keep studying this term.</div>';
                }
                document.getElementById('term-feedback').innerHTML += feedbackHTML;
                
                // Automatically move to next term after a short delay
                setTimeout(() => {
                    nextTerm();
                }, 1500);
            } catch (error) {
                console.error('Error in rateAnswer:', error);
                showNotification('Error', 'An error occurred when rating the answer', 'error');
            }
        }

        function previousTerm() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showTerm();
            }
        }

        function nextTerm() {
            currentQuestionIndex++;
            showTerm();
        }

        // Reports Functions
        function updateReportsDisplay() {
            updateCharts();
            updateMasteryDisplay();
            updateOverallStats();
        }

        function updateCharts() {
            const modes = ['quiz', 'terms', 'exam'];
            const modeNames = ['Smart Quiz', 'Smart Terms', 'Smart Advance'];
            
            modes.forEach((mode, index) => {
                const canvasId = mode === 'exam' ? 'advanceChart' : mode + 'Chart';
                const ctx = document.getElementById(canvasId)?.getContext('2d');
                
                if (!ctx) return;
                
                // Destroy existing chart
                if (charts[mode]) {
                    charts[mode].destroy();
                }
                
                // Calculate data
                let mastered = 0, correct = 0, incorrect = 0, unanswered = 0;
                
                for (let subject in progressData) {
                    for (let topic in progressData[subject]) {
                        const topicData = progressData[subject][topic][mode];
                        if (mode === 'terms') {
                            const ratings = Object.values(topicData.ratings || {});
                            mastered += ratings.filter(r => r === 'easy').length;
                            correct += ratings.filter(r => r === 'medium').length;
                            incorrect += ratings.filter(r => r === 'hard').length;
                        } else {
                            if (topicData.mastered) mastered++;
                            else if (topicData.total > 0) {
                                correct += topicData.correct;
                                incorrect += topicData.total - topicData.correct;
                            } else {
                                unanswered++;
                            }
                        }
                    }
                }
                
                const data = mode === 'terms' 
                    ? [mastered, correct, incorrect]
                    : [mastered, correct, incorrect, unanswered];
                    
                const labels = mode === 'terms'
                    ? ['Easy', 'Medium', 'Hard']
                    : ['Mastered', 'Correct', 'Incorrect', 'Unanswered'];
                    
                const colors = mode === 'terms'
                    ? ['#10b981', '#f59e0b', '#ef4444']
                    : ['#10b981', '#6366f1', '#ef4444', '#94a3b8'];

                charts[mode] = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: colors,
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 10,
                                    font: {
                                        size: 11
                                    }
                                }
                            }
                        }
                    }
                });
                
                // Update last attempt
                const lastAttemptSpan = document.getElementById(mode === 'exam' ? 'advance-last-attempt' : mode + '-last-attempt');
                if (lastAttemptSpan) {
                    let lastAttempt = 0;
                    for (let subject in progressData) {
                        for (let topic in progressData[subject]) {
                            const topicData = progressData[subject][topic][mode];
                            if (topicData.lastAttempt && topicData.lastAttempt > lastAttempt) {
                                lastAttempt = topicData.lastAttempt;
                            }
                        }
                    }
                    
                    if (lastAttempt > 0) {
                        const daysAgo = Math.floor((Date.now() - lastAttempt) / (1000 * 60 * 60 * 24));
                        lastAttemptSpan.textContent = daysAgo === 0 ? 'Today' : daysAgo === 1 ? 'Yesterday' : `${daysAgo} days ago`;
                    } else {
                        lastAttemptSpan.textContent = 'Not started';
                    }
                }
            });
        }

        function updateMasteryDisplay() {
            const masteryGrid = document.getElementById('mastery-grid');
            masteryGrid.innerHTML = '';
            
            for (let subject in progressData) {
                for (let topic in progressData[subject]) {
                    const topicData = progressData[subject][topic];
                    
                    for (let mode in topicData) {
                        if (topicData[mode].total > 0 || Object.keys(topicData[mode].ratings || {}).length > 0) {
                            const masteryCard = document.createElement('div');
                            masteryCard.className = 'mastery-card';
                            
                            let percentage = 0;
                            let statusText = 'In Progress';
                            
                            if (mode === 'terms') {
                                const ratings = Object.values(topicData[mode].ratings || {});
                                const goodRatings = ratings.filter(r => r === 'easy' || r === 'medium').length;
                                percentage = ratings.length > 0 ? Math.round((goodRatings / ratings.length) * 100) : 0;
                                if (topicData[mode].mastered) statusText = ' Mastered';
                            } else {
                                percentage = topicData[mode].total > 0 ? 
                                    Math.round((topicData[mode].correct / topicData[mode].total) * 100) : 0;
                                if (topicData[mode].mastered) statusText = ' Mastered';
                            }
                            
                            const modeName = mode === 'quiz' ? 'Smart Quiz' : mode === 'terms' ? 'Smart Terms' : 'Smart Advance';
                            const totalText = mode === 'terms' ? 
                                Object.keys(topicData[mode].ratings || {}).length + ' rated' :
                                topicData[mode].correct + '/' + topicData[mode].total;
                            
                            masteryCard.innerHTML = `
                                <div class="mastery-header">
                                    <div class="mastery-title">${subject} - ${topic}</div>
                                    <div class="mastery-percentage">${percentage}%</div>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${percentage}%"></div>
                                </div>
                                <div class="mastery-stats">
                                    <span>${modeName}</span>
                                    <span>${totalText}</span>
                                    <span>${statusText}</span>
                                </div>
                            `;
                            
                            masteryGrid.appendChild(masteryCard);
                        }
                    }
                }
            }
            
            if (masteryGrid.children.length === 0) {
                masteryGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; color: var(--text-secondary); padding: 40px;">No progress data yet. Start studying to see your progress here!</div>';
            }
        }

        function updateOverallStats() {
            let totalQuestions = 0;
            let totalCorrect = 0;
            let masteredTopics = 0;
            
            for (let subject in progressData) {
                for (let topic in progressData[subject]) {
                    const topicData = progressData[subject][topic];
                    
                    // Count mastered topics
                    if (topicData.quiz.mastered || topicData.terms.mastered || topicData.exam.mastered) {
                        masteredTopics++;
                    }
                    
                    // Count questions
                    totalQuestions += topicData.quiz.total + topicData.exam.total + Object.keys(topicData.terms.ratings || {}).length;
                    totalCorrect += topicData.quiz.correct + topicData.exam.correct;
                    
                    // Count good term ratings as correct
                    const ratings = Object.values(topicData.terms.ratings || {});
                    totalCorrect += ratings.filter(r => r === 'easy' || r === 'medium').length;
                }
            }
            
            const avgScore = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
            
            document.getElementById('avg-score').textContent = avgScore + '%';
            document.getElementById('total-questions').textContent = totalQuestions;
            document.getElementById('topics-mastered').textContent = masteredTopics;
            
            // Calculate study streak (placeholder)
            document.getElementById('study-streak').textContent = '3'; // This would be calculated based on daily activity
        }

        function showReport(reportType) {
            showSection('reports');
            
            // You could add specific report filtering here
            showNotification('Report Opened', `Viewing ${reportType} report`, 'info');
        }

        // Settings Functions
        function toggleTheme() {
            settings.darkMode = !settings.darkMode;
            document.documentElement.setAttribute('data-theme', settings.darkMode ? 'dark' : 'light');
            document.getElementById('theme-toggle').classList.toggle('active', settings.darkMode);
            saveSettings();
            
            showNotification('Theme Changed', `Switched to ${settings.darkMode ? 'dark' : 'light'} mode`, 'success');
        }

        function toggleSetting(settingName) {
            settings[settingName] = !settings[settingName];
            const toggleId = settingName.replace(/([A-Z])/g, '-$1').toLowerCase() + '-toggle';
            const toggleElement = document.getElementById(toggleId);
            
            if (toggleElement) {
                toggleElement.classList.toggle('active', settings[settingName]);
                saveSettings();
                
                const settingLabels = {
                    autoProgress: 'Auto Progress',
                    sounds: 'Sound Effects', 
                    shuffle: 'Shuffle Questions',
                    immediateReading: 'Immediate Feedback'
                };
                
                showNotification('Setting Updated', `${settingLabels[settingName]} ${settings[settingName] ? 'enabled' : 'disabled'}`, 'info');
            } else {
                console.error(`Toggle element with ID ${toggleId} not found`);
            }
        }

        // Data Management Functions
        function exportData() {
            const dataToExport = {
                progress: progressData,
                settings: settings,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `smart-revise-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('Data Exported', 'Your progress and settings have been exported', 'success');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (importedData.progress) {
                        progressData = importedData.progress;
                        saveProgress();
                    }
                    
                    if (importedData.settings) {
                        settings = importedData.settings;
                        saveSettings();
                        initializeSettings();
                    }
                    
                    updateReportsDisplay();
                    showNotification('Data Imported', 'Your data has been successfully imported', 'success');
                    
                } catch (error) {
                    showNotification('Import Failed', 'Invalid file format or corrupted data', 'error');
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone!')) {
                progressData = {};
                initializeProgress();
                updateReportsDisplay();
                showNotification('Progress Reset', 'All progress data has been reset', 'warning');
            }
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all data including settings? This cannot be undone!')) {
                localStorage.removeItem('smartReviseProgress');
                localStorage.removeItem('smartReviseSettings');
                
                progressData = {};
                settings = {
                    darkMode: false,
                    autoProgress: false,
                    sounds: true,
                    shuffle: true,
                    immediateReading: true
                };
                
                initializeProgress();
                initializeSettings();
                updateReportsDisplay();
                
                showNotification('All Data Cleared', 'All data and settings have been cleared', 'error');
            }
        }

        function updateProgress(question, isCorrect) {
            try {
                const topic = question.topic;
                if (!topic) {
                    console.error('Question has no topic defined:', question);
                    return;
                }
                
                // Initialize progress data if needed
                if (!progressData[currentSubject]) {
                    progressData[currentSubject] = {};
                }
                if (!progressData[currentSubject][topic]) {
                    progressData[currentSubject][topic] = {
                        quiz: { correct: 0, total: 0, streak: 0, mastered: false, lastAttempt: null, questionStreaks: {} },
                        terms: { ratings: {}, total: 0, mastered: false, lastAttempt: null },
                        exam: { correct: 0, total: 0, streak: 0, mastered: false, lastAttempt: null }
                    };
                }
                
                // Ensure questionStreaks exists
                if (!progressData[currentSubject][topic][currentMode].questionStreaks) {
                    progressData[currentSubject][topic][currentMode].questionStreaks = {};
                }
                
                const topicProgress = progressData[currentSubject][topic][currentMode];
                topicProgress.total++;
                topicProgress.lastAttempt = Date.now();
                
                // Track streak for the specific question
                if (!topicProgress.questionStreaks[question.question]) {
                    topicProgress.questionStreaks[question.question] = 0;
                }
                
                if (isCorrect) {
                    topicProgress.correct++;
                    
                    if (currentMode !== 'terms') {
                        topicProgress.streak = (topicProgress.streak || 0) + 1;
                        // Increment streak for this specific question
                        topicProgress.questionStreaks[question.question]++;
                        
                        // Check for mastery (3 correct in a row for quiz/exam)
                        if (topicProgress.streak >= 3) {
                            topicProgress.mastered = true;
                        }
                    }
                } else {
                    if (currentMode !== 'terms') {
                        topicProgress.streak = 0;
                        // Reset streak for this specific question
                        topicProgress.questionStreaks[question.question] = 0;
                    }
                }
                
                // Update the progress bar
                if (currentMode === 'quiz') {
                    updateProgressBar(topicProgress.questionStreaks[question.question]);
                }
                
                saveProgress();
                
                // Update analytics
                updateHomeAnalytics();
            } catch (error) {
                console.error('Error in updateProgress:', error);
            }
        }
    </script>
</body>
</html>
<script>
// This function is no longer used since we've updated to use the marking scheme
// It's kept for reference
function markTypedAnswer() {
    const answer = document.getElementById("typed-answer").value.trim();
    const question = currentQuestions[currentQuestionIndex];
    const feedbackContainer = document.getElementById("feedback-container");
    let feedbackHTML = '';

    if (answer.length > 10) {
        correctAnswers++;
        currentStreak++;
        feedbackHTML = '<div class="feedback correct"><i class="fas fa-check-circle"></i>Answer accepted. Great job!</div>';
        updateProgress(question.topic, true);
    } else {
        currentStreak = 0;
        feedbackHTML = '<div class="feedback incorrect"><i class="fas fa-times-circle"></i>Answer too short. Try again.</div>';
        updateProgress(question.topic, false);
    }

    feedbackContainer.innerHTML = feedbackHTML;
    document.getElementById('streak-count').textContent = currentStreak;
    document.getElementById('correct-count').textContent = correctAnswers;
}

// Fix for settings page
document.addEventListener('DOMContentLoaded', function() {
    // Add direct click handler for settings tab
    document.getElementById('settings-tab').addEventListener('click', function() {
        // Hide all other sections
        document.getElementById('home-section').classList.add('hidden');
        document.getElementById('subject-selection').classList.add('hidden');
        document.getElementById('topic-selection').classList.add('hidden');
        document.getElementById('mode-selection-container').classList.add('hidden');
        document.getElementById('question-section').classList.add('hidden');
        document.getElementById('terms-section').classList.add('hidden');
        document.getElementById('reports-section').classList.add('hidden');
        
        // Update active tab
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        document.getElementById('settings-tab').classList.add('active');
        
        // Show settings section
        document.getElementById('settings-section').classList.remove('hidden');
    });
    
    // Fix settings toggles
    document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
    document.getElementById('auto-progress-toggle').addEventListener('click', function() {
        toggleSetting('autoProgress');
    });
    document.getElementById('sound-toggle').addEventListener('click', function() {
        toggleSetting('sounds');
    });
    document.getElementById('shuffle-toggle').addEventListener('click', function() {
        toggleSetting('shuffle');
    });
    document.getElementById('feedback-toggle').addEventListener('click', function() {
        toggleSetting('immediateReading');
    });
    
    // Update settings display to match stored values
    initializeSettings();
});
</script>